{"version":3,"file":"userfront-core.module.js","sources":["../src/constants.js","../src/mode.js","../src/store.js","../src/tokens.js","../src/cookies.js","../src/url.js","../src/signon.js","../src/logout.js","../src/iframe.js","../src/index.js"],"sourcesContent":["export const apiUrl = `https://api.userfront.com/v0/`;\n\nexport const privateIPRegex = /((^127\\.)|(^10\\.)|(^172\\.1[6-9]\\.)|(^172\\.2[0-9]\\.)|(^172\\.3[0-1]\\.)|(^192\\.168\\.))\\d{1,3}\\.\\d{1,3}/g;\n","import axios from \"axios\";\n\nimport { apiUrl, privateIPRegex } from \"./constants.js\";\nimport { store } from \"./store.js\";\n\n/**\n * Determine whether a hostname is in test mode.\n * @param {String} hn\n */\nexport function isTestHostname(hn) {\n  try {\n    const hostname = hn || window.location.hostname;\n    return !!(hostname.match(/localhost/g) || hostname.match(privateIPRegex));\n  } catch (err) {\n    return true;\n  }\n}\n\n/**\n * Define the mode of operation (live or test)\n */\nexport async function setMode() {\n  try {\n    const { data } = await axios.get(`${apiUrl}tenants/${store.tenantId}/mode`);\n    store.mode = data.mode || \"test\";\n  } catch (err) {\n    store.mode = \"test\";\n  }\n}\n","import { isTestHostname } from \"./mode.js\";\n\nexport const store = {\n  mode: isTestHostname() ? \"test\" : \"live\",\n};\n","import Cookies from \"js-cookie\";\n\nimport { store } from \"./store.js\";\n\n/**\n * Set and then return the access token\n */\nexport function accessToken() {\n  store.accessToken = Cookies.get(store.accessTokenName);\n  return store.accessToken;\n}\n\n/**\n * Set and then return the ID token\n */\nexport function idToken() {\n  store.idToken = Cookies.get(store.idTokenName);\n  return store.idToken;\n}\n\n/**\n * Define the store token values from the cookie values.\n */\nexport function setTokensFromCookies() {\n  store.accessToken = Cookies.get(store.accessTokenName);\n  store.idToken = Cookies.get(store.idTokenName);\n  store.refreshToken = Cookies.get(store.refreshTokenName);\n}\n\nexport default {\n  accessToken,\n  idToken,\n  setTokensFromCookies,\n};\n","import Cookies from \"js-cookie\";\nimport { store } from \"./store.js\";\nimport { setTokensFromCookies } from \"./tokens.js\";\n\n/**\n * Set a cookie value based on the given options.\n * @param {String} value\n * @param {Object} options\n * @param {String} type\n */\nexport function setCookie(value, options, type) {\n  const cookieName = `${type}.${store.tenantId}`;\n  options = options || {\n    secure: store.mode === \"live\",\n    sameSite: \"Lax\",\n  };\n  if (type === \"refresh\") {\n    options.sameSite = \"Strict\";\n  }\n  Cookies.set(cookieName, value, options);\n}\n\n/**\n * Remove a cookie by name, regardless of its cookie setting(s).\n * @param {String} name\n */\nfunction removeCookie(name) {\n  Cookies.remove(name);\n  Cookies.remove(name, { secure: true, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: true, sameSite: \"None\" });\n  Cookies.remove(name, { secure: false, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: false, sameSite: \"None\" });\n}\n\n/**\n * Remove all auth cookies (access, id, refresh).\n */\nexport function removeAllCookies() {\n  removeCookie(store.accessTokenName);\n  removeCookie(store.idTokenName);\n  removeCookie(store.refreshTokenName);\n  store.accessToken = undefined;\n  store.idToken = undefined;\n  store.refreshToken = undefined;\n}\n\n/**\n * Set the cookies from a tokens object, and add to the local store.\n * @param {Object} tokens\n */\nexport function setCookiesAndTokens(tokens) {\n  setCookie(tokens.access.value, tokens.access.cookieOptions, \"access\");\n  setCookie(tokens.id.value, tokens.id.cookieOptions, \"id\");\n  setCookie(tokens.refresh.value, tokens.refresh.cookieOptions, \"refresh\");\n  setTokensFromCookies();\n}\n\nexport default {\n  setCookie,\n  removeAllCookies,\n  setCookiesAndTokens,\n};\n","import axios from \"axios\";\n\nimport { apiUrl } from \"./constants.js\";\nimport { store } from \"./store.js\";\nimport { removeAllCookies } from \"./cookies.js\";\n\n/**\n * Get the value of a query attribute, e.g. ?attr=value\n * @param {String} attrName\n */\nexport function getQueryAttr(attrName) {\n  if (\n    !window.location.href ||\n    window.location.href.indexOf(`${attrName}=`) < 0\n  ) {\n    return;\n  }\n  return decodeURIComponent(\n    window.location.href.split(`${attrName}=`)[1].split(\"&\")[0]\n  );\n}\n\n// TODO replace with direct check of the access token.\n/**\n * If the access token is valid, redirect the browser to the\n * tenant's login redirection path (path after login).\n */\nexport async function redirectIfLoggedIn() {\n  if (!store.accessToken) {\n    return removeAllCookies();\n  }\n  if (getQueryAttr(\"redirect\")) {\n    return redirectToPath(getQueryAttr(\"redirect\"));\n  }\n\n  try {\n    const { data } = await axios.get(`${apiUrl}self`, {\n      headers: {\n        authorization: `Bearer ${store.accessToken}`,\n      },\n    });\n    if (data.tenant && data.tenant.loginRedirectPath) {\n      redirectToPath(data.tenant.loginRedirectPath);\n    }\n  } catch (err) {\n    removeAllCookies();\n  }\n}\n\n/**\n * Redirect to path portion of a URL.\n */\nexport function redirectToPath(pathOrUrl) {\n  try {\n    document;\n  } catch (error) {\n    return;\n  }\n  if (!pathOrUrl) return;\n  const el = document.createElement(\"a\");\n  el.href = pathOrUrl;\n  let path = `${el.pathname}${el.hash}${el.search}`;\n  if (el.pathname !== window.location.pathname) {\n    window.location.assign(path);\n  }\n}\n\nexport default {\n  redirectIfLoggedIn,\n};\n","import { store } from \"./store.js\";\nimport { getQueryAttr } from \"./url.js\";\n\n/**\n * This file has methods for signing up and logging in\n */\n\n/**\n * Register a user via the provided method. This method serves to call other\n * methods, depending on the \"method\" parameter passed in.\n * @param {Object} options\n */\nexport async function signup({ method, username, name, email, password }) {\n  if (!method) {\n    throw new Error('Userfront.signup called without \"method\" property');\n  }\n  switch (method) {\n    case \"azure\":\n    case \"facebook\":\n    case \"github\":\n    case \"google\":\n    case \"linkedin\":\n      return signupWithSSO(method);\n    case \"password\":\n      return signupWithPassword({ username, name, email, password });\n    default:\n      throw new Error('Userfront.signup called with invalid \"method\" property');\n  }\n}\n\n/**\n * Register a new user in via SSO provider.\n * Redirect the browser after successful authentication and 302 redirect from server.\n * @param {String} provider Name of SSO provider\n */\nfunction signupWithSSO(provider) {\n  if (!provider) throw new Error(\"Missing provider\");\n  const url = getProviderLink(provider);\n  window.location.assign(url);\n}\n\n/**\n * Register a new user with username, name, email, and password.\n * Redirect the browser after successful signup based on the redirectTo value returned.\n * @param {Object} options\n */\nasync function signupWithPassword({ username, name, email, password }) {\n  const { data } = await axios.post(`${apiUrl}auth/create`, {\n    tenantId: store.tenantId,\n    username,\n    name,\n    email,\n    password,\n  });\n\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\"Please try again.\");\n  }\n}\n\n/**\n * Log a user in via the provided method. This method serves to call other\n * methods, depending on the \"method\" parameter passed in.\n * @param {Object} options\n */\nexport async function login({\n  method,\n  email,\n  username,\n  emailOrUsername,\n  password,\n  token,\n  uuid,\n}) {\n  if (!method) {\n    throw new Error('Userfront.login called without \"method\" property');\n  }\n  switch (method) {\n    case \"azure\":\n    case \"facebook\":\n    case \"github\":\n    case \"google\":\n    case \"linkedin\":\n      return loginWithSSO(method);\n    case \"password\":\n      return loginWithPassword({ email, username, emailOrUsername, password });\n    case \"link\":\n      return loginWithLink(token, uuid);\n    default:\n      throw new Error('Userfront.login called with invalid \"method\" property');\n  }\n}\n\n/**\n * Log a user in via SSO provider.\n * Redirect the browser after successful authentication and 302 redirect from server.\n * @param {String} provider Name of SSO provider\n */\nfunction loginWithSSO(provider) {\n  if (!provider) throw new Error(\"Missing provider\");\n  const url = getProviderLink(provider);\n  window.location.assign(url);\n}\n\nfunction getProviderLink(provider) {\n  if (!provider) throw new Error(\"Missing provider\");\n  if (!store.tenantId) throw new Error(\"Missing tenant ID\");\n\n  let url = `https://api.userfront.com/v0/auth/${provider}/login?tenant_id=${store.tenantId}&origin=${window.location.origin}`;\n\n  const redirect = getQueryAttr(\"redirect\");\n  if (redirect) {\n    url += `&redirect=${encodeURIComponent(redirect)}`;\n  }\n\n  return url;\n}\n\n/**\n * Log a user in with email/username and password.\n * Redirect the browser after successful login based on the redirectTo value returned.\n * @param {Object} options\n */\nasync function loginWithPassword({\n  email,\n  username,\n  emailOrUsername,\n  password,\n}) {\n  const { data } = await axios.post(`${apiUrl}auth/basic`, {\n    tenantId: store.tenantId,\n    emailOrUsername: email || username || emailOrUsername,\n    password,\n  });\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\"Please try again.\");\n  }\n}\n\n/**\n * Log a user in with a token/uuid combo passed into the function or\n * in the URL querystring. ?token=...&uuid=...\n * @param {String} token\n * @param {UUID} uuid\n */\nasync function loginWithLink(token, uuid) {\n  if (!token) token = getQueryAttr(\"token\");\n  if (!uuid) uuid = getQueryAttr(\"uuid\");\n  if (!token || !uuid) return;\n\n  const { data } = await axios.put(`${apiUrl}auth/link`, {\n    token,\n    uuid,\n    tenantId: store.tenantId,\n  });\n\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\"Problem logging in.\");\n  }\n}\n\n/**\n * Send a login link to the provided email.\n * @param {String} email\n */\nexport async function sendLoginLink(email) {\n  try {\n    const { data } = await axios.post(`${apiUrl}auth/link`, {\n      email,\n      tenantId: store.tenantId,\n    });\n    return data;\n  } catch (err) {\n    throw new Error(\"Problem sending link\");\n  }\n}\n\n/**\n * Send a password reset link to the provided email.\n * @param {String} email\n */\nexport async function sendResetLink(email) {\n  try {\n    const { data } = await axios.post(`${apiUrl}auth/reset/link`, {\n      email,\n      tenantId: store.tenantId,\n    });\n    return data;\n  } catch (err) {\n    throw new Error(\"Problem sending link\");\n  }\n}\n\nexport async function resetPassword({ uuid, token, password }) {\n  if (!token) token = getQueryAttr(\"token\");\n  if (!uuid) uuid = getQueryAttr(\"uuid\");\n  if (!token || !uuid) throw new Error(\"Missing token or uuid\");\n  const { data } = await axios.put(`${apiUrl}auth/reset`, {\n    tenantId: store.tenantId,\n    uuid,\n    token,\n    password,\n  });\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\n      \"There was a problem resetting your password. Please try again.\"\n    );\n  }\n}\n\nexport default {\n  signup,\n  login,\n  sendLoginLink,\n  sendResetLink,\n  resetPassword,\n};\n","import axios from \"axios\";\n\nimport { apiUrl } from \"./constants\";\nimport { store } from \"./store.js\";\nimport { removeAllCookies } from \"./cookies.js\";\nimport { redirectToPath } from \"./url\";\n\n/**\n * Log a user out and redirect to the logout path.\n */\nexport async function logout() {\n  if (!store.accessToken) return removeAllCookies();\n  try {\n    const { data } = await axios.get(`${apiUrl}auth/logout`, {\n      headers: {\n        authorization: `Bearer ${store.accessToken}`,\n      },\n    });\n    removeAllCookies();\n    redirectToPath(data.redirectTo);\n  } catch (err) {\n    removeAllCookies();\n  }\n}\n","import { setCookiesAndTokens } from \"./cookies.js\";\n\nconst frameUrl = \"https://auth.userfront.net\";\nconst frameId = \"uf-auth-frame\";\n\nlet iframe;\n\n/**\n * Add the auth iframe to the document body, if the iframe\n * has not been added already.\n */\nexport function setIframe() {\n  try {\n    if (iframe) return;\n    iframe = document.createElement(\"iframe\");\n    iframe.src = frameUrl;\n    iframe.id = frameId;\n    iframe.style.width = \"0px\";\n    iframe.style.height = \"0px\";\n    iframe.style.display = \"none\";\n    document.body.appendChild(iframe);\n    addIframeMessageListener();\n  } catch (error) {}\n}\n\n/**\n * Return the iframe element\n */\nexport function getIframe() {\n  return iframe;\n}\n\n/**\n * Separated this call out from addIframeMessageListener\n * in order to make it testable.\n *\n * @param {*} e - iframe event\n */\nexport function triageEvent(e) {\n  if (!e || e.origin !== frameUrl || !e.data || !e.data.type) return;\n  switch (e.data.type) {\n    case \"exchange\":\n      console.log(\"exchange\");\n      break;\n    case \"refresh\":\n      setCookiesAndTokens(e.data.body.tokens);\n      break;\n    case \"logout\":\n      console.log(\"logout\");\n      break;\n    default:\n      return;\n  }\n}\n\n/**\n * Add an event listener to the window that will accept messages\n * from the iframe.\n */\nfunction addIframeMessageListener() {\n  try {\n    window.addEventListener(\"message\", triageEvent);\n  } catch (error) {}\n}\n\nexport default {\n  setIframe,\n  getIframe,\n};\n","import { store } from \"./store.js\";\nimport { accessToken, idToken, setTokensFromCookies } from \"./tokens\";\nimport { redirectIfLoggedIn } from \"./url.js\";\nimport {\n  login,\n  resetPassword,\n  sendLoginLink,\n  sendResetLink,\n  signup,\n} from \"./signon.js\";\nimport { logout } from \"./logout.js\";\nimport { isTestHostname, setMode } from \"./mode.js\";\nimport { setIframe } from \"./iframe.js\";\n\nlet initCallbacks = [];\n\n/**\n * Initialize the Userfront library.\n * @param {String} tenantId\n */\nexport function init(tenantId) {\n  if (!tenantId) return console.warn(\"Userfront initialized without tenant ID\");\n  store.tenantId = tenantId;\n  store.accessTokenName = `access.${tenantId}`;\n  store.idTokenName = `id.${tenantId}`;\n  store.refreshTokenName = `refresh.${tenantId}`;\n  setIframe();\n  setTokensFromCookies();\n  try {\n    if (initCallbacks.length > 0) {\n      initCallbacks.forEach((cb) => {\n        if (!cb || typeof cb !== \"function\") return;\n        cb({ tenantId });\n      });\n    }\n    initCallbacks = [];\n  } catch (error) {}\n}\n\n/**\n * Add a callback function to be called upon Userfront.init()\n * @param {Function} cb\n */\nexport function addInitCallback(cb) {\n  if (!cb || typeof cb !== \"function\") return;\n  initCallbacks.push(cb);\n}\n\n/**\n * Register a window-level event called \"urlchanged\" that will fire\n * whenever the browser URL changes.\n */\nlet isRegistered = false;\nfunction registerUrlChangedEventListener() {\n  if (isRegistered) return;\n  isRegistered = true;\n  try {\n    history.pushState = ((f) =>\n      function pushState() {\n        var ret = f.apply(this, arguments);\n        window.dispatchEvent(new Event(\"pushstate\"));\n        window.dispatchEvent(new Event(\"urlchanged\"));\n        return ret;\n      })(history.pushState);\n\n    history.replaceState = ((f) =>\n      function replaceState() {\n        var ret = f.apply(this, arguments);\n        window.dispatchEvent(new Event(\"replacestate\"));\n        window.dispatchEvent(new Event(\"urlchanged\"));\n        return ret;\n      })(history.replaceState);\n\n    window.addEventListener(\"popstate\", () => {\n      window.dispatchEvent(new Event(\"urlchanged\"));\n    });\n  } catch (error) {}\n}\n\n/**\n * EXPORTS\n */\n\nexport { logout } from \"./logout.js\";\nexport { isTestHostname, setMode } from \"./mode\";\nexport {\n  login,\n  resetPassword,\n  sendLoginLink,\n  sendResetLink,\n  signup,\n} from \"./signon.js\";\nexport { store } from \"./store\";\nexport { accessToken, idToken } from \"./tokens\";\nexport { redirectIfLoggedIn } from \"./url.js\";\n\nexport default {\n  // index\n  addInitCallback,\n  init,\n  registerUrlChangedEventListener,\n\n  //logout\n  logout,\n\n  // mode\n  isTestHostname,\n  setMode,\n\n  // signon\n  login,\n  resetPassword,\n  sendLoginLink,\n  sendResetLink,\n  signup,\n\n  // store\n  store,\n\n  // tokens\n  accessToken,\n  idToken,\n\n  // url\n  redirectIfLoggedIn,\n};\n"],"names":["apiUrl","privateIPRegex","setMode","body","recover","result","axios","get","store","tenantId","data","mode","e","then","isTestHostname","hn","hostname","window","location","match","err","accessToken","Cookies","accessTokenName","idToken","idTokenName","setTokensFromCookies","refreshToken","refreshTokenName","setCookie","value","options","type","cookieName","secure","sameSite","set","removeCookie","name","remove","removeAllCookies","undefined","redirectIfLoggedIn","getQueryAttr","redirectToPath","headers","authorization","tenant","loginRedirectPath","attrName","href","indexOf","decodeURIComponent","split","pathOrUrl","document","error","el","createElement","pathname","assign","hash","search","resetPassword","uuid","token","password","Error","put","tokens","setCookiesAndTokens","redirectTo","sendResetLink","email","post","sendLoginLink","login","method","username","emailOrUsername","provider","url","getProviderLink","loginWithSSO","loginWithPassword","loginWithLink","signup","signupWithSSO","signupWithPassword","origin","redirect","encodeURIComponent","logout","frameUrl","iframe","triageEvent","console","log","access","cookieOptions","id","refresh","initCallbacks","init","warn","src","style","width","height","display","appendChild","addEventListener","addIframeMessageListener","setIframe","length","forEach","cb","addInitCallback","push","isRegistered","registerUrlChangedEventListener","history","pushState","f","ret","apply","this","arguments","dispatchEvent","Event","replaceState"],"mappings":"oDAAaA,EAAU,gCAEVC,EAAiB,uGCmBRC,yBA6hBf,SAAgBC,EAAMC,GAC5B,IACC,IAAIC,kBA7hBqBC,EAAMC,IAAK,GAAEP,YAAiBQ,EAAMC,iCAArDC,KAAEA,IACRF,EAAMG,KAAOD,EAAKC,MAAQ,SA6hB3B,MAAMC,GACP,OAAOR,IAER,OAAIC,GAAUA,EAAOQ,KACbR,EAAOQ,UAAK,EAAQT,GAErBC,gBAjiBJG,EAAMG,KAAO,uEALjB,6CAZgBG,EAAeC,GAC7B,IACE,MAAMC,EAAWD,GAAME,OAAOC,SAASF,SACvC,SAAUA,EAASG,MAAM,gBAAiBH,EAASG,MAAMlB,IACzD,MAAOmB,GACP,UCZSZ,MAAAA,EAAQ,CACnBG,KAAMG,IAAmB,OAAS,iBCIpBO,IAEd,OADAb,EAAMa,YAAcC,EAAQf,IAAIC,EAAMe,iBAC/Bf,EAAMa,qBAMCG,IAEd,OADAhB,EAAMgB,QAAUF,EAAQf,IAAIC,EAAMiB,aAC3BjB,EAAMgB,iBAMCE,IACdlB,EAAMa,YAAcC,EAAQf,IAAIC,EAAMe,iBACtCf,EAAMgB,QAAUF,EAAQf,IAAIC,EAAMiB,aAClCjB,EAAMmB,aAAeL,EAAQf,IAAIC,EAAMoB,2BChBzBC,EAAUC,EAAOC,EAASC,GACxC,MAAMC,EAAc,GAAED,KAAQxB,EAAMC,WACpCsB,EAAUA,GAAW,CACnBG,OAAuB,SAAf1B,EAAMG,KACdwB,SAAU,OAEC,YAATH,IACFD,EAAQI,SAAW,UAErBb,EAAQc,IAAIH,EAAYH,EAAOC,GAOjC,SAASM,EAAaC,GACpBhB,EAAQiB,OAAOD,GACfhB,EAAQiB,OAAOD,EAAM,CAAEJ,QAAQ,EAAMC,SAAU,QAC/Cb,EAAQiB,OAAOD,EAAM,CAAEJ,QAAQ,EAAMC,SAAU,SAC/Cb,EAAQiB,OAAOD,EAAM,CAAEJ,QAAQ,EAAOC,SAAU,QAChDb,EAAQiB,OAAOD,EAAM,CAAEJ,QAAQ,EAAOC,SAAU,SAMlD,SAAgBK,IACdH,EAAa7B,EAAMe,iBACnBc,EAAa7B,EAAMiB,aACnBY,EAAa7B,EAAMoB,kBACnBpB,EAAMa,iBAAcoB,EACpBjC,EAAMgB,aAAUiB,EAChBjC,EAAMmB,kBAAec,EChBDC,MAAAA,iBACpB,IAAKlC,EAAMa,YACT,uBAAOmB,KAET,GAAIG,EAAa,YACf,uBAAOC,EAAeD,EAAa,cALI,QAuhBpC,SAAgBxC,EAAMC,GAC5B,IACC,IAAIC,kBAhhBqBC,EAAMC,IAAOP,EAAF,OAAgB,CAChD6C,QAAS,CACPC,cAAgB,UAAStC,EAAMa,+BAF7BX,KAAEA,IAKJA,EAAKqC,QAAUrC,EAAKqC,OAAOC,mBAC7BJ,EAAelC,EAAKqC,OAAOC,qBA2gB9B,MAAMpC,GACP,OAAOR,IAER,OAAIC,GAAUA,EAAOQ,KACbR,EAAOQ,UAAK,EAAQT,GAErBC,gBA9gBJmC,oEAlBJ,6CAjBgBG,EAAaM,GAC3B,GACGhC,OAAOC,SAASgC,QACjBjC,OAAOC,SAASgC,KAAKC,QAAWF,EAAF,KAAiB,GAIjD,OAAOG,mBACLnC,OAAOC,SAASgC,KAAKG,MAASJ,EAAF,KAAe,GAAGI,MAAM,KAAK,IAkC7D,SAAgBT,EAAeU,GAC7B,IACEC,SACA,MAAOC,GACP,OAEF,IAAKF,EAAW,OAChB,MAAMG,EAAKF,SAASG,cAAc,KAClCD,EAAGP,KAAOI,EAENG,EAAGE,WAAa1C,OAAOC,SAASyC,UAClC1C,OAAOC,SAAS0C,OAFN,GAAEH,EAAGE,WAAWF,EAAGI,OAAOJ,EAAGK,UCqfpC,WAAgB3D,EAAMC,GAC5B,IACC,IAAIC,EAASF,IACZ,MAAMS,GACP,OAAOR,EAAQQ,GAEhB,OAAIP,GAAUA,EAAOQ,KACbR,EAAOQ,UAAK,EAAQT,GAErBC,EAjXR,MAAsB0D,YAAcC,KAAEA,EAAFC,MAAQA,EAARC,SAAeA,QAGjD,GAFKD,IAAOA,EAAQtB,EAAa,UAC5BqB,IAAMA,EAAOrB,EAAa,UAC1BsB,IAAUD,EAAM,UAAUG,MAAM,yBAHwB,uBAItC7D,MAAM8D,IAAOpE,OAAF,aAAsB,CACtDS,SAAUD,EAAMC,SAChBuD,KAAAA,EACAC,MAAAA,EACAC,SAAAA,oBAJIxD,KAAEA,QAMJA,EAAK2D,OAIP,UAAUF,MACR,kEAJFG,oBAAoB5D,EAAK2D,QACzBzB,eAAeD,EAAa,aAAejC,EAAK6D,YAAc,OAZlE,oCAZsBC,WAAcC,kEAETnE,MAAMoE,KAAQ1E,OAAF,kBAA2B,CAC5DyE,MAAAA,EACAhE,SAAUD,EAAMC,2BAFZC,KAAEA,IAIR,OAAOA,gBAEP,UAAUyD,MAAM,2BARpB,oCAhBsBQ,WAAcF,kEAETnE,MAAMoE,KAAQ1E,OAAF,YAAqB,CACtDyE,MAAAA,EACAhE,SAAUD,EAAMC,2BAFZC,KAAEA,IAIR,OAAOA,gBAEP,UAAUyD,MAAM,2BARpB,oCA1GsBS,YAAMC,OAC1BA,EAD0BJ,MAE1BA,EAF0BK,SAG1BA,EAH0BC,gBAI1BA,EAJ0Bb,SAK1BA,EAL0BD,MAM1BA,EAN0BD,KAO1BA,QAEA,IAAKa,EACH,UAAUV,MAAM,oDAElB,OAAQU,GACN,IAAK,QACL,IAAK,WACL,IAAK,SACL,IAAK,SACL,IAAK,WACH,uBAeN,SAAsBG,GACpB,IAAKA,EAAU,UAAUb,MAAM,oBAC/B,MAAMc,EAAMC,EAAgBF,GAC5B/D,OAAOC,SAAS0C,OAAOqB,GAlBZE,CAAaN,IACtB,IAAK,WACH,iBAsC2BJ,MAC/BA,EAD+BK,SAE/BA,EAF+BC,gBAG/BA,EAH+Bb,SAI/BA,+BAEuB5D,MAAMoE,KAAQ1E,OAAF,aAAsB,CACvDS,SAAUD,EAAMC,SAChBsE,gBAAiBN,GAASK,GAAYC,EACtCb,SAAAA,oBAHIxD,KAAEA,QAKJA,EAAK2D,OAIP,UAAUF,MAAM,qBAHhBG,oBAAoB5D,EAAK2D,QACzBzB,eAAeD,EAAa,aAAejC,EAAK6D,YAAc,0CAnDrDa,CAAkB,CAAEX,MAAAA,EAAOK,SAAAA,EAAUC,gBAAAA,EAAiBb,SAAAA,IAC/D,IAAK,OACH,gBA6DuBD,EAAOD,OAGlC,OAFKC,IAAOA,EAAQtB,EAAa,UAC5BqB,IAAMA,EAAOrB,EAAa,SAC1BsB,GAAUD,kBAEQ1D,MAAM8D,IAAOpE,OAAF,YAAqB,CACrDiE,MAAAA,EACAD,KAAAA,EACAvD,SAAUD,EAAMC,2BAHZC,KAAEA,QAMJA,EAAK2D,OAIP,UAAUF,MAAM,uBAHhBG,oBAAoB5D,EAAK2D,QACzBzB,eAAeD,EAAa,aAAejC,EAAK6D,YAAc,4DA1ErDc,CAAcpB,EAAOD,GAC9B,QACE,UAAUG,MAAM,0DAxBtB,oCAxDsBmB,YAAOT,OAAEA,EAAFC,SAAUA,EAAVxC,KAAoBA,EAApBmC,MAA0BA,EAA1BP,SAAiCA,QAC5D,IAAKW,EACH,UAAUV,MAAM,qDAElB,OAAQU,GACN,IAAK,QACL,IAAK,WACL,IAAK,SACL,IAAK,SACL,IAAK,WACH,uBAaN,SAAuBG,GACrB,IAAKA,EAAU,UAAUb,MAAM,oBAC/B,MAAMc,EAAMC,EAAgBF,GAC5B/D,OAAOC,SAAS0C,OAAOqB,GAhBZM,CAAcV,IACvB,IAAK,WACH,iBAsB4BC,SAAEA,EAAFxC,KAAYA,EAAZmC,MAAkBA,EAAlBP,SAAyBA,+BAClC5D,MAAMoE,KAAQ1E,OAAF,cAAuB,CACxDS,SAAUD,EAAMC,SAChBqE,SAAAA,EACAxC,KAAAA,EACAmC,MAAAA,EACAP,SAAAA,oBALIxD,KAAEA,QAQJA,EAAK2D,OAIP,UAAUF,MAAM,qBAHhBG,oBAAoB5D,EAAK2D,QACzBzB,eAAeD,EAAa,aAAejC,EAAK6D,YAAc,0CAjCrDiB,CAAmB,CAAEV,SAAAA,EAAUxC,KAAAA,EAAMmC,MAAAA,EAAOP,SAAAA,IACrD,QACE,UAAUC,MAAM,2DAdtB,oCA+FA,SAASe,EAAgBF,GACvB,IAAKA,EAAU,UAAUb,MAAM,oBAC/B,IAAK3D,EAAMC,SAAU,UAAU0D,MAAM,qBAErC,IAAIc,EAAO,qCAAoCD,qBAA4BxE,EAAMC,mBAAmBQ,OAAOC,SAASuE,SAEpH,MAAMC,EAAW/C,EAAa,YAK9B,OAJI+C,IACFT,GAAQ,aAAYU,mBAAmBD,IAGlCT,EC5GT,MAAsBW,iBACpB,IAAKpF,EAAMa,YAAa,uBAAOmB,KADF,QAwiBxB,SAAgBrC,EAAMC,GAC5B,IACC,IAAIC,kBAviBqBC,EAAMC,IAAOP,EAAF,cAAuB,CACvD6C,QAAS,CACPC,cAAgB,UAAStC,EAAMa,+BAF7BX,KAAEA,IAKR8B,IACAI,EAAelC,EAAK6D,cAkiBrB,MAAM3D,GACP,OAAOR,IAER,OAAIC,GAAUA,EAAOQ,KACbR,EAAOQ,UAAK,EAAQT,GAErBC,gBAtiBJmC,oEAXJ,oCCRMqD,EAAW,6BAGjB,IAAIC,EAuBJ,SAUgBC,EAAYnF,GJY5B,IAAoCyD,EIXlC,GAAKzD,GAAKA,EAAE6E,SAAWI,GAAajF,EAAEF,MAASE,EAAEF,KAAKsB,KACtD,OAAQpB,EAAEF,KAAKsB,MACb,IAAK,WACHgE,QAAQC,IAAI,YACZ,MACF,IAAK,UJOPpE,GADkCwC,EILVzD,EAAEF,KAAKP,KAAKkE,QJMnB6B,OAAOpE,MAAOuC,EAAO6B,OAAOC,cAAe,UAC5DtE,EAAUwC,EAAO+B,GAAGtE,MAAOuC,EAAO+B,GAAGD,cAAe,MACpDtE,EAAUwC,EAAOgC,QAAQvE,MAAOuC,EAAOgC,QAAQF,cAAe,WAC9DzE,IIRI,MACF,IAAK,SACHsE,QAAQC,IAAI,UACZ,MACF,QACE,QCrCN,IAAIK,EAAgB,YAMJC,EAAK9F,GACnB,IAAKA,EAAU,OAAOuF,QAAQQ,KAAK,2CACnChG,EAAMC,SAAWA,EACjBD,EAAMe,gBAAmB,UAASd,EAClCD,EAAMiB,YAAe,MAAKhB,EAC1BD,EAAMoB,iBAAoB,WAAUnB,EDdtC,WACE,IACE,GAAIqF,EAAQ,OACZA,EAASvC,SAASG,cAAc,UAChCoC,EAAOW,IAAMZ,EACbC,EAAOM,GAbK,gBAcZN,EAAOY,MAAMC,MAAQ,MACrBb,EAAOY,MAAME,OAAS,MACtBd,EAAOY,MAAMG,QAAU,OACvBtD,SAASpD,KAAK2G,YAAYhB,GAuC9B,WACE,IACE7E,OAAO8F,iBAAiB,UAAWhB,GACnC,MAAOvC,KAzCPwD,GACA,MAAOxD,KCITyD,GACAvF,IACA,IACM4E,EAAcY,OAAS,GACzBZ,EAAca,QAASC,IAChBA,GAAoB,mBAAPA,GAClBA,EAAG,CAAE3G,SAAAA,MAGT6F,EAAgB,GAChB,MAAO9C,cAOK6D,EAAgBD,GACzBA,GAAoB,mBAAPA,GAClBd,EAAcgB,KAAKF,GAOrB,IAAIG,GAAe,EA+BnB,MAae,CAEbF,gBAAAA,EACAd,KAAAA,EACAiB,gCA/CF,WACE,IAAID,EAAJ,CACAA,GAAe,EACf,IACEE,QAAQC,WAAcC,EAMjBF,QAAQC,UALX,WACE,IAAIE,EAAMD,EAAEE,MAAMC,KAAMC,WAGxB,OAFA9G,OAAO+G,cAAc,IAAIC,MAAM,cAC/BhH,OAAO+G,cAAc,IAAIC,MAAM,eACxBL,IAGXH,QAAQS,aAAe,CAAEP,GACvB,WACE,IAAIC,EAAMD,EAAEE,MAAMC,KAAMC,WAGxB,OAFA9G,OAAO+G,cAAc,IAAIC,MAAM,iBAC/BhH,OAAO+G,cAAc,IAAIC,MAAM,eACxBL,GALY,CAMlBH,QAAQS,cAEbjH,OAAO8F,iBAAiB,WAAY,KAClC9F,OAAO+G,cAAc,IAAIC,MAAM,iBAEjC,MAAOzE,IAnBa,IAAEmE,IA8CxB/B,OAAAA,EAGA9E,eAAAA,EACAZ,QAAAA,EAGA0E,MAAAA,EACAb,cAAAA,EACAY,cAAAA,EACAH,cAAAA,EACAc,OAAAA,EAGA9E,MAAAA,EAGAa,YAAAA,EACAG,QAAAA,EAGAkB,mBAAAA"}