{"version":3,"file":"userfront-core.modern.js","sources":["../src/index.js","../src/constants.js"],"sourcesContent":["import axios from \"axios\";\nimport Cookies from \"js-cookie\";\n\nimport constants from \"./constants\";\nconst { apiUrl, privateIPRegex } = constants;\n\nconst isTestHostname = (hn) => {\n  try {\n    const hostname = hn || window.location.hostname;\n    return !!(hostname.match(/localhost/g) || hostname.match(privateIPRegex));\n  } catch (err) {\n    return true;\n  }\n};\n\nconst scope = {\n  mode: isTestHostname() ? \"test\" : \"live\",\n};\n\nfunction init(tenantId, opts = {}) {\n  if (!tenantId) return console.warn(\"Userfront initialized without tenant ID\");\n  scope.tenantId = tenantId;\n  scope.signupModId = opts.signup;\n  scope.loginModId = opts.login;\n  scope.logoutModId = opts.logout;\n  scope.resetModId = opts.reset;\n  scope.accessTokenName = `access.${tenantId}`;\n  scope.idTokenName = `id.${tenantId}`;\n  scope.refreshTokenName = `refresh.${tenantId}`;\n}\n\nasync function getMode() {\n  try {\n    const { data } = await axios.get(`${apiUrl}tenants/${scope.tenantId}/mode`);\n    scope.mode = data.mode || \"test\";\n  } catch (err) {\n    scope.mode = \"test\";\n  }\n}\n\nasync function signup({ username, name, email, password }) {\n  const { data } = await axios.post(`${apiUrl}auth/create`, {\n    tenantId: scope.tenantId,\n    username,\n    name,\n    email,\n    password,\n  });\n\n  if (data.tokens) {\n    setCookie(\n      data.tokens.access.value,\n      data.tokens.access.cookieOptions,\n      \"access\"\n    );\n    setCookie(data.tokens.id.value, data.tokens.id.cookieOptions, \"id\");\n    setCookie(\n      data.tokens.refresh.value,\n      data.tokens.refresh.cookieOptions,\n      \"refresh\"\n    );\n    window.location.href = data.redirectTo;\n  } else {\n    throw new Error(\"Please try again.\");\n  }\n}\n\nfunction redirectTo(url) {\n  try {\n  } catch (err) {}\n}\n\nasync function logout() {\n  const token = Cookies.get(scope.accessTokenName);\n  if (!token) return;\n\n  try {\n    const { data } = await axios.get(`${apiUrl}/auth/logout`, {\n      headers: {\n        authorization: `Bearer ${token}`,\n      },\n    });\n\n    removeCookie(scope.accessTokenName);\n    removeCookie(scope.idTokenName);\n    removeCookie(scope.refreshTokenName);\n    window.location.href = data.redirectTo;\n  } catch (err) {}\n}\n\nfunction setCookie(token, options, type) {\n  const cookieName = `${type}.${scope.tenantId}`;\n  options = options || {\n    secure: scope.mode === \"live\",\n    sameSite: \"Lax\",\n  };\n  if (type === \"refresh\") {\n    options.sameSite = \"Strict\";\n  }\n  Cookies.set(cookieName, token, options);\n}\n\nfunction removeCookie(name) {\n  Cookies.remove(name);\n  Cookies.remove(name, { secure: true, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: true, sameSite: \"None\" });\n  Cookies.remove(name, { secure: false, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: false, sameSite: \"None\" });\n}\n\nexport default {\n  getMode,\n  init,\n  isTestHostname,\n  logout,\n  scope,\n  setCookie,\n  signup,\n};\n","export default {\n  apiUrl: `https://api.userfront.com/v0/`,\n  privateIPRegex: /((^127\\.)|(^10\\.)|(^172\\.1[6-9]\\.)|(^172\\.2[0-9]\\.)|(^172\\.3[0-1]\\.)|(^192\\.168\\.))\\d{1,3}\\.\\d{1,3}/g,\n};\n"],"names":["apiUrl","privateIPRegex","isTestHostname","hn","hostname","window","location","match","err","scope","mode","setCookie","token","options","type","cookieName","tenantId","secure","sameSite","Cookies","set","removeCookie","name","remove","getMode","async","data","axios","get","init","opts","console","warn","signupModId","signup","loginModId","login","logoutModId","logout","resetModId","reset","accessTokenName","idTokenName","refreshTokenName","headers","authorization","href","redirectTo","username","email","password","post","tokens","Error","access","value","cookieOptions","id","refresh"],"mappings":"8CAIA,MAAMA,OAAEA,EAAFC,eAAUA,GCJD,CACbD,OAAS,gCACTC,eAAgB,wGDIZC,EAAkBC,IACtB,IACE,MAAMC,EAAWD,GAAME,OAAOC,SAASF,SACvC,SAAUA,EAASG,MAAM,gBAAiBH,EAASG,MAAMN,IACzD,MAAOO,GACP,WAIEC,EAAQ,CACZC,KAAMR,IAAmB,OAAS,QA0EpC,SAASS,EAAUC,EAAOC,EAASC,GACjC,MAAMC,EAAc,GAAED,KAAQL,EAAMO,WACpCH,EAAUA,GAAW,CACnBI,OAAuB,SAAfR,EAAMC,KACdQ,SAAU,OAEC,YAATJ,IACFD,EAAQK,SAAW,UAErBC,EAAQC,IAAIL,EAAYH,EAAOC,GAGjC,SAASQ,EAAaC,GACpBH,EAAQI,OAAOD,GACfH,EAAQI,OAAOD,EAAM,CAAEL,QAAQ,EAAMC,SAAU,QAC/CC,EAAQI,OAAOD,EAAM,CAAEL,QAAQ,EAAMC,SAAU,SAC/CC,EAAQI,OAAOD,EAAM,CAAEL,QAAQ,EAAOC,SAAU,QAChDC,EAAQI,OAAOD,EAAM,CAAEL,QAAQ,EAAOC,SAAU,SAGlD,MAAe,CACbM,QAhFFC,iBACE,IACE,MAAMC,KAAEA,SAAeC,EAAMC,IAAK,GAAE5B,YAAiBS,EAAMO,iBAC3DP,EAAMC,KAAOgB,EAAKhB,MAAQ,OAC1B,MAAOF,GACPC,EAAMC,KAAO,SA4EfmB,KA7FF,SAAcb,EAAUc,EAAO,IAC7B,IAAKd,EAAU,OAAOe,QAAQC,KAAK,2CACnCvB,EAAMO,SAAWA,EACjBP,EAAMwB,YAAcH,EAAKI,OACzBzB,EAAM0B,WAAaL,EAAKM,MACxB3B,EAAM4B,YAAcP,EAAKQ,OACzB7B,EAAM8B,WAAaT,EAAKU,MACxB/B,EAAMgC,gBAAmB,UAASzB,EAClCP,EAAMiC,YAAe,MAAK1B,EAC1BP,EAAMkC,iBAAoB,WAAU3B,GAqFpCd,eAAAA,EACAoC,OA/CFb,iBAME,MAAMb,EAAQO,EAAQS,IAAInB,EAAMgC,iBAChC,GAAK7B,EAEL,IACE,MAAMc,KAAEA,SAAeC,EAAMC,IAAO5B,EAAF,eAAwB,CACxD4C,QAAS,CACPC,cAAgB,UAASjC,KAI7BS,EAAaZ,EAAMgC,iBACnBpB,EAAaZ,EAAMiC,aACnBrB,EAAaZ,EAAMkC,kBACnBtC,OAAOC,SAASwC,KAAOpB,EAAKqB,WAC5B,MAAOvC,MA4BTC,MAAAA,EACAE,UAAAA,EACAuB,OA7EFT,gBAAsBuB,SAAEA,EAAF1B,KAAYA,EAAZ2B,MAAkBA,EAAlBC,SAAyBA,IAC7C,MAAMxB,KAAEA,SAAeC,EAAMwB,KAAQnD,EAAF,cAAuB,CACxDgB,SAAUP,EAAMO,SAChBgC,SAAAA,EACA1B,KAAAA,EACA2B,MAAAA,EACAC,SAAAA,IAGF,IAAIxB,EAAK0B,OAcP,UAAUC,MAAM,qBAbhB1C,EACEe,EAAK0B,OAAOE,OAAOC,MACnB7B,EAAK0B,OAAOE,OAAOE,cACnB,UAEF7C,EAAUe,EAAK0B,OAAOK,GAAGF,MAAO7B,EAAK0B,OAAOK,GAAGD,cAAe,MAC9D7C,EACEe,EAAK0B,OAAOM,QAAQH,MACpB7B,EAAK0B,OAAOM,QAAQF,cACpB,WAEFnD,OAAOC,SAASwC,KAAOpB,EAAKqB"}