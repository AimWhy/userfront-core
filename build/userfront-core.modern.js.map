{"version":3,"file":"userfront-core.modern.js","sources":["../src/index.js","../src/constants.js"],"sourcesContent":["import axios from \"axios\";\nimport Cookies from \"js-cookie\";\n\nimport constants from \"./constants\";\nconst { apiUrl, privateIPRegex } = constants;\n\nconst isTestHostname = (hn) => {\n  try {\n    const hostname = hn || window.location.hostname;\n    return !!(hostname.match(/localhost/g) || hostname.match(privateIPRegex));\n  } catch (err) {\n    return true;\n  }\n};\n\nconst store = {\n  mode: isTestHostname() ? \"test\" : \"live\",\n};\n\nfunction init(tenantId, opts = {}) {\n  if (!tenantId) return console.warn(\"Userfront initialized without tenant ID\");\n  store.tenantId = tenantId;\n  store.accessTokenName = `access.${tenantId}`;\n  store.idTokenName = `id.${tenantId}`;\n  store.refreshTokenName = `refresh.${tenantId}`;\n}\n\nasync function setMode() {\n  try {\n    const { data } = await axios.get(`${apiUrl}tenants/${store.tenantId}/mode`);\n    store.mode = data.mode || \"test\";\n  } catch (err) {\n    store.mode = \"test\";\n  }\n}\n\nasync function signup({ username, name, email, password }) {\n  const { data } = await axios.post(`${apiUrl}auth/create`, {\n    tenantId: store.tenantId,\n    username,\n    name,\n    email,\n    password,\n  });\n\n  if (data.tokens) {\n    setCookie(\n      data.tokens.access.value,\n      data.tokens.access.cookieOptions,\n      \"access\"\n    );\n    setCookie(data.tokens.id.value, data.tokens.id.cookieOptions, \"id\");\n    setCookie(\n      data.tokens.refresh.value,\n      data.tokens.refresh.cookieOptions,\n      \"refresh\"\n    );\n    window.location.href = data.redirectTo;\n  } else {\n    throw new Error(\"Please try again.\");\n  }\n}\n\nfunction redirectTo(url) {\n  try {\n  } catch (err) {}\n}\n\nasync function logout() {\n  const token = Cookies.get(store.accessTokenName);\n  if (!token) return;\n\n  try {\n    const { data } = await axios.get(`${apiUrl}auth/logout`, {\n      headers: {\n        authorization: `Bearer ${token}`,\n      },\n    });\n\n    removeCookie(store.accessTokenName);\n    removeCookie(store.idTokenName);\n    removeCookie(store.refreshTokenName);\n    window.location.href = data.redirectTo;\n  } catch (err) {}\n}\n\nfunction setCookie(token, options, type) {\n  const cookieName = `${type}.${store.tenantId}`;\n  options = options || {\n    secure: store.mode === \"live\",\n    sameSite: \"Lax\",\n  };\n  if (type === \"refresh\") {\n    options.sameSite = \"Strict\";\n  }\n  Cookies.set(cookieName, token, options);\n}\n\nfunction removeCookie(name) {\n  Cookies.remove(name);\n  Cookies.remove(name, { secure: true, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: true, sameSite: \"None\" });\n  Cookies.remove(name, { secure: false, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: false, sameSite: \"None\" });\n}\n\nexport default {\n  setMode,\n  init,\n  isTestHostname,\n  logout,\n  setCookie,\n  signup,\n  store,\n};\n","export default {\n  apiUrl: `https://api.userfront.com/v0/`,\n  privateIPRegex: /((^127\\.)|(^10\\.)|(^172\\.1[6-9]\\.)|(^172\\.2[0-9]\\.)|(^172\\.3[0-1]\\.)|(^192\\.168\\.))\\d{1,3}\\.\\d{1,3}/g,\n};\n"],"names":["apiUrl","privateIPRegex","isTestHostname","hn","hostname","window","location","match","err","store","mode","setCookie","token","options","type","cookieName","tenantId","secure","sameSite","Cookies","set","removeCookie","name","remove","setMode","async","data","axios","get","init","opts","console","warn","accessTokenName","idTokenName","refreshTokenName","logout","headers","authorization","href","redirectTo","signup","username","email","password","post","tokens","Error","access","value","cookieOptions","id","refresh"],"mappings":"8CAIA,MAAMA,OAAEA,EAAFC,eAAUA,GCJD,CACbD,OAAS,gCACTC,eAAgB,wGDIZC,EAAkBC,IACtB,IACE,MAAMC,EAAWD,GAAME,OAAOC,SAASF,SACvC,SAAUA,EAASG,MAAM,gBAAiBH,EAASG,MAAMN,IACzD,MAAOO,GACP,WAIEC,EAAQ,CACZC,KAAMR,IAAmB,OAAS,QAsEpC,SAASS,EAAUC,EAAOC,EAASC,GACjC,MAAMC,EAAc,GAAED,KAAQL,EAAMO,WACpCH,EAAUA,GAAW,CACnBI,OAAuB,SAAfR,EAAMC,KACdQ,SAAU,OAEC,YAATJ,IACFD,EAAQK,SAAW,UAErBC,EAAQC,IAAIL,EAAYH,EAAOC,GAGjC,SAASQ,EAAaC,GACpBH,EAAQI,OAAOD,GACfH,EAAQI,OAAOD,EAAM,CAAEL,QAAQ,EAAMC,SAAU,QAC/CC,EAAQI,OAAOD,EAAM,CAAEL,QAAQ,EAAMC,SAAU,SAC/CC,EAAQI,OAAOD,EAAM,CAAEL,QAAQ,EAAOC,SAAU,QAChDC,EAAQI,OAAOD,EAAM,CAAEL,QAAQ,EAAOC,SAAU,SAGlD,MAAe,CACbM,QAhFFC,iBACE,IACE,MAAMC,KAAEA,SAAeC,EAAMC,IAAK,GAAE5B,YAAiBS,EAAMO,iBAC3DP,EAAMC,KAAOgB,EAAKhB,MAAQ,OAC1B,MAAOF,GACPC,EAAMC,KAAO,SA4EfmB,KAzFF,SAAcb,EAAUc,EAAO,IAC7B,IAAKd,EAAU,OAAOe,QAAQC,KAAK,2CACnCvB,EAAMO,SAAWA,EACjBP,EAAMwB,gBAAmB,UAASjB,EAClCP,EAAMyB,YAAe,MAAKlB,EAC1BP,EAAM0B,iBAAoB,WAAUnB,GAqFpCd,eAAAA,EACAkC,OA/CFX,iBAME,MAAMb,EAAQO,EAAQS,IAAInB,EAAMwB,iBAChC,GAAKrB,EAEL,IACE,MAAMc,KAAEA,SAAeC,EAAMC,IAAO5B,EAAF,cAAuB,CACvDqC,QAAS,CACPC,cAAgB,UAAS1B,KAI7BS,EAAaZ,EAAMwB,iBACnBZ,EAAaZ,EAAMyB,aACnBb,EAAaZ,EAAM0B,kBACnB9B,OAAOC,SAASiC,KAAOb,EAAKc,WAC5B,MAAOhC,MA4BTG,UAAAA,EACA8B,OA5EFhB,gBAAsBiB,SAAEA,EAAFpB,KAAYA,EAAZqB,MAAkBA,EAAlBC,SAAyBA,IAC7C,MAAMlB,KAAEA,SAAeC,EAAMkB,KAAQ7C,EAAF,cAAuB,CACxDgB,SAAUP,EAAMO,SAChB0B,SAAAA,EACApB,KAAAA,EACAqB,MAAAA,EACAC,SAAAA,IAGF,IAAIlB,EAAKoB,OAcP,UAAUC,MAAM,qBAbhBpC,EACEe,EAAKoB,OAAOE,OAAOC,MACnBvB,EAAKoB,OAAOE,OAAOE,cACnB,UAEFvC,EAAUe,EAAKoB,OAAOK,GAAGF,MAAOvB,EAAKoB,OAAOK,GAAGD,cAAe,MAC9DvC,EACEe,EAAKoB,OAAOM,QAAQH,MACpBvB,EAAKoB,OAAOM,QAAQF,cACpB,WAEF7C,OAAOC,SAASiC,KAAOb,EAAKc,YAwD9B/B,MAAAA"}