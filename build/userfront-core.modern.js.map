{"version":3,"file":"userfront-core.modern.js","sources":["../src/index.js"],"sourcesContent":["const axios = require(\"axios\");\nconst Cookies = require(\"js-cookie\");\n\nconst { apiUrl, privateIPRegex } = require(\"./constants\");\n\nconst isTestHostname = (hn) => {\n  try {\n    const hostname = hn || window.location.hostname;\n    return !!(hostname.match(/localhost/g) || hostname.match(privateIPRegex));\n  } catch (err) {\n    return true;\n  }\n};\n\nconst scope = {\n  mode: isTestHostname() ? \"test\" : \"live\",\n};\n\nfunction init(tenantId, opts = {}) {\n  if (!tenantId) return console.warn(\"Userfront initialized without tenant ID\");\n  scope.tenantId = tenantId;\n  scope.signupModId = opts.signup;\n  scope.loginModId = opts.login;\n  scope.logoutModId = opts.logout;\n  scope.resetModId = opts.reset;\n  scope.accessTokenName = `access.${tenantId}`;\n  scope.idTokenName = `id.${tenantId}`;\n  scope.refreshTokenName = `refresh.${tenantId}`;\n}\n\nasync function getMode() {\n  try {\n    const { data } = await axios.get(`${apiUrl}tenants/${scope.tenantId}/mode`);\n    scope.mode = data.mode || \"test\";\n  } catch (err) {\n    scope.mode = \"test\";\n  }\n}\n\nasync function signup({ username, name, email, password }) {\n  const { data } = await axios.post(`${apiUrl}auth/create`, {\n    tenantId: scope.tenantId,\n    username,\n    name,\n    email,\n    password,\n  });\n\n  if (data.tokens) {\n    setCookie(\n      data.tokens.access.value,\n      data.tokens.access.cookieOptions,\n      \"access\"\n    );\n    setCookie(data.tokens.id.value, data.tokens.id.cookieOptions, \"id\");\n    setCookie(\n      data.tokens.refresh.value,\n      data.tokens.refresh.cookieOptions,\n      \"refresh\"\n    );\n    window.location.href = data.redirectTo;\n  } else {\n    throw new Error(\"Please try again.\");\n  }\n}\n\nfunction redirectTo(url) {\n  try {\n  } catch (err) {}\n}\n\nasync function logout() {\n  const token = Cookies.get(scope.accessTokenName);\n  if (!token) return;\n\n  try {\n    const { data } = await axios.get(`${apiUrl}/auth/logout`, {\n      headers: {\n        authorization: `Bearer ${token}`,\n      },\n    });\n\n    removeCookie(scope.accessTokenName);\n    removeCookie(scope.idTokenName);\n    removeCookie(scope.refreshTokenName);\n    window.location.href = data.redirectTo;\n  } catch (err) {}\n}\n\nfunction setCookie(token, options, type) {\n  const cookieName = `${type}.${scope.tenantId}`;\n  options = options || {\n    secure: scope.mode === \"live\",\n    sameSite: \"Lax\",\n  };\n  if (type === \"refresh\") {\n    options.sameSite = \"Strict\";\n  }\n  Cookies.set(cookieName, token, options);\n}\n\nfunction removeCookie(name) {\n  Cookies.remove(name);\n  Cookies.remove(name, { secure: true, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: true, sameSite: \"None\" });\n  Cookies.remove(name, { secure: false, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: false, sameSite: \"None\" });\n}\n\nmodule.exports = {\n  getMode,\n  init,\n  isTestHostname,\n  logout,\n  scope,\n  setCookie,\n  signup,\n};\n"],"names":["axios","require","Cookies","apiUrl","privateIPRegex","isTestHostname","hn","hostname","window","location","match","err","scope","mode","setCookie","token","options","type","cookieName","tenantId","secure","sameSite","set","removeCookie","name","remove","module","exports","getMode","async","data","get","init","opts","console","warn","signupModId","signup","loginModId","login","logoutModId","logout","resetModId","reset","accessTokenName","idTokenName","refreshTokenName","headers","authorization","href","redirectTo","username","email","password","post","tokens","Error","access","value","cookieOptions","id","refresh"],"mappings":"AAAA,MAAMA,EAAQC,QAAQ,SAChBC,EAAUD,QAAQ,cAElBE,OAAEA,EAAFC,eAAUA,GAAmBH,QAAQ,eAErCI,EAAkBC,IACtB,IACE,MAAMC,EAAWD,GAAME,OAAOC,SAASF,SACvC,SAAUA,EAASG,MAAM,gBAAiBH,EAASG,MAAMN,IACzD,MAAOO,GACP,WAIEC,EAAQ,CACZC,KAAMR,IAAmB,OAAS,QA0EpC,SAASS,EAAUC,EAAOC,EAASC,GACjC,MAAMC,EAAc,GAAED,KAAQL,EAAMO,WACpCH,EAAUA,GAAW,CACnBI,OAAuB,SAAfR,EAAMC,KACdQ,SAAU,OAEC,YAATJ,IACFD,EAAQK,SAAW,UAErBnB,EAAQoB,IAAIJ,EAAYH,EAAOC,GAGjC,SAASO,EAAaC,GACpBtB,EAAQuB,OAAOD,GACftB,EAAQuB,OAAOD,EAAM,CAAEJ,QAAQ,EAAMC,SAAU,QAC/CnB,EAAQuB,OAAOD,EAAM,CAAEJ,QAAQ,EAAMC,SAAU,SAC/CnB,EAAQuB,OAAOD,EAAM,CAAEJ,QAAQ,EAAOC,SAAU,QAChDnB,EAAQuB,OAAOD,EAAM,CAAEJ,QAAQ,EAAOC,SAAU,SAGlDK,OAAOC,QAAU,CACfC,QAhFFC,iBACE,IACE,MAAMC,KAAEA,SAAe9B,EAAM+B,IAAK,GAAE5B,YAAiBS,EAAMO,iBAC3DP,EAAMC,KAAOiB,EAAKjB,MAAQ,OAC1B,MAAOF,GACPC,EAAMC,KAAO,SA4EfmB,KA7FF,SAAcb,EAAUc,EAAO,IAC7B,IAAKd,EAAU,OAAOe,QAAQC,KAAK,2CACnCvB,EAAMO,SAAWA,EACjBP,EAAMwB,YAAcH,EAAKI,OACzBzB,EAAM0B,WAAaL,EAAKM,MACxB3B,EAAM4B,YAAcP,EAAKQ,OACzB7B,EAAM8B,WAAaT,EAAKU,MACxB/B,EAAMgC,gBAAmB,UAASzB,EAClCP,EAAMiC,YAAe,MAAK1B,EAC1BP,EAAMkC,iBAAoB,WAAU3B,GAqFpCd,eAAAA,EACAoC,OA1CFZ,iBACE,MAAMd,EAAQb,EAAQ6B,IAAInB,EAAMgC,iBAChC,GAAK7B,EAEL,IACE,MAAMe,KAAEA,SAAe9B,EAAM+B,IAAO5B,EAAF,eAAwB,CACxD4C,QAAS,CACPC,cAAgB,UAASjC,KAI7BQ,EAAaX,EAAMgC,iBACnBrB,EAAaX,EAAMiC,aACnBtB,EAAaX,EAAMkC,kBACnBtC,OAAOC,SAASwC,KAAOnB,EAAKoB,WAC5B,MAAOvC,MA4BTC,MAAAA,EACAE,UAAAA,EACAuB,OA7EFR,gBAAsBsB,SAAEA,EAAF3B,KAAYA,EAAZ4B,MAAkBA,EAAlBC,SAAyBA,IAC7C,MAAMvB,KAAEA,SAAe9B,EAAMsD,KAAQnD,EAAF,cAAuB,CACxDgB,SAAUP,EAAMO,SAChBgC,SAAAA,EACA3B,KAAAA,EACA4B,MAAAA,EACAC,SAAAA,IAGF,IAAIvB,EAAKyB,OAcP,UAAUC,MAAM,qBAbhB1C,EACEgB,EAAKyB,OAAOE,OAAOC,MACnB5B,EAAKyB,OAAOE,OAAOE,cACnB,UAEF7C,EAAUgB,EAAKyB,OAAOK,GAAGF,MAAO5B,EAAKyB,OAAOK,GAAGD,cAAe,MAC9D7C,EACEgB,EAAKyB,OAAOM,QAAQH,MACpB5B,EAAKyB,OAAOM,QAAQF,cACpB,WAEFnD,OAAOC,SAASwC,KAAOnB,EAAKoB"}