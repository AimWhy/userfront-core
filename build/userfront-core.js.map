<<<<<<< HEAD
{"version":3,"file":"userfront-core.js","sources":["../src/constants.js","../src/index.js","../src/user.js"],"sourcesContent":["export const apiUrl = `https://api.userfront.com/v0/`;\n\nexport const privateIPRegex =\n  /((^127\\.)|(^10\\.)|(^172\\.1[6-9]\\.)|(^172\\.2[0-9]\\.)|(^172\\.3[0-1]\\.)|(^192\\.168\\.))\\d{1,3}\\.\\d{1,3}/g;\n\nexport default {\n  apiUrl,\n  privateIPRegex,\n};\n","import axios from \"axios\";\nimport Cookies from \"js-cookie\";\nimport jwt from \"jsonwebtoken\";\nimport { JwksClient } from \"jwks-rsa\";\n\nimport { apiUrl, privateIPRegex } from \"./constants.js\";\nimport createUser from \"./user.js\";\n\nlet initCallbacks = [];\n\n/**\n * Determine whether a hostname is in test mode.\n * @param {String} hn\n */\nconst isTestHostname = (hn) => {\n  try {\n    const hostname = hn || window.location.hostname;\n    return !!(hostname.match(/localhost/g) || hostname.match(privateIPRegex));\n  } catch (err) {\n    return true;\n  }\n};\n\nconst store = {\n  mode: isTestHostname() ? \"test\" : \"live\",\n  user: {},\n};\n\n/**\n * Initialize the Userfront library.\n * @param {String} tenantId\n */\nfunction init(tenantId) {\n  if (!tenantId) return console.warn(\"Userfront initialized without tenant ID\");\n  store.tenantId = tenantId;\n  store.accessTokenName = `access.${tenantId}`;\n  store.idTokenName = `id.${tenantId}`;\n  store.refreshTokenName = `refresh.${tenantId}`;\n  setTokensFromCookies();\n\n  if (store.idToken) {\n    setUser();\n  }\n\n  try {\n    if (initCallbacks.length > 0) {\n      initCallbacks.forEach((cb) => {\n        if (!cb || typeof cb !== \"function\") return;\n        cb({ tenantId });\n      });\n    }\n    initCallbacks = [];\n  } catch (error) {}\n}\n\n/**\n * Add a callback function to be called upon Userfront.init()\n * @param {Function} cb\n */\nfunction addInitCallback(cb) {\n  if (!cb || typeof cb !== \"function\") return;\n  initCallbacks.push(cb);\n}\n\n/**\n * Set and then return the access token\n */\nfunction accessToken() {\n  store.accessToken = Cookies.get(store.accessTokenName);\n  return store.accessToken;\n}\n\n/**\n * Set and then return the ID token\n */\nfunction idToken() {\n  store.idToken = Cookies.get(store.idTokenName);\n  return store.idToken;\n}\n\n/**\n * Verify provided token was issued by Userfront API\n * @param {String} token\n * @returns {Promise<void>} The provided token has been verified if `verifyToken` resolves without error\n */\nasync function verifyToken(token) {\n  if (!token) throw new Error(\"Missing token\");\n\n  let publicKey;\n  try {\n    const decodedToken = jwt.decode(token, { complete: true });\n    if (!decodedToken.header || !decodedToken.header.kid) {\n      throw new Error(\"Token kid not defined\");\n    }\n\n    const client = new JwksClient({\n      jwksUri: `${apiUrl}tenants/${store.tenantId}/jwks/${store.mode}`,\n      requestHeaders: { origin: window.location.origin },\n    });\n\n    const key = await client.getSigningKey(decodedToken.header.kid);\n    publicKey = key.getPublicKey();\n  } catch (error) {\n    throw error;\n  }\n\n  if (!publicKey) {\n    throw new Error(\"Public key not found\");\n  }\n\n  try {\n    jwt.verify(token, publicKey);\n  } catch (error) {\n    throw new Error(\"Token verification failed\");\n  }\n\n  return Promise.resolve();\n}\n\n/**\n * Get the value of a query attribute, e.g. ?attr=value\n * @param {String} attrName\n */\nfunction getQueryAttr(attrName) {\n  if (\n    !window.location.href ||\n    window.location.href.indexOf(`${attrName}=`) < 0\n  ) {\n    return;\n  }\n  return decodeURIComponent(\n    window.location.href.split(`${attrName}=`)[1].split(\"&\")[0]\n  );\n}\n\nfunction getProviderLink(provider) {\n  if (!provider) throw new Error(\"Missing provider\");\n  if (!store.tenantId) throw new Error(\"Missing tenant ID\");\n\n  let url = `https://api.userfront.com/v0/auth/${provider}/login?tenant_id=${store.tenantId}&origin=${window.location.origin}`;\n\n  const redirect = getQueryAttr(\"redirect\");\n  if (redirect) {\n    url += `&redirect=${encodeURIComponent(redirect)}`;\n  }\n\n  return url;\n}\n\n/**\n * Define the mode of operation (live or test)\n */\nasync function setMode() {\n  try {\n    const { data } = await axios.get(`${apiUrl}tenants/${store.tenantId}/mode`);\n    store.mode = data.mode || \"test\";\n  } catch (err) {\n    store.mode = \"test\";\n  }\n}\n\n/**\n * Register a user via the provided method. This method serves to call other\n * methods, depending on the \"method\" parameter passed in.\n * @param {Object} options\n */\nasync function signup({ method, username, name, email, password }) {\n  if (!method) {\n    throw new Error('Userfront.signup called without \"method\" property');\n  }\n  switch (method) {\n    case \"azure\":\n    case \"facebook\":\n    case \"github\":\n    case \"google\":\n    case \"linkedin\":\n      return signupWithSSO(method);\n    case \"password\":\n      return signupWithPassword({ username, name, email, password });\n    default:\n      throw new Error('Userfront.signup called with invalid \"method\" property');\n  }\n}\n\n/**\n * Register a new user in via SSO provider.\n * Redirect the browser after successful authentication and 302 redirect from server.\n * @param {String} provider Name of SSO provider\n */\nfunction signupWithSSO(provider) {\n  if (!provider) throw new Error(\"Missing provider\");\n  const url = getProviderLink(provider);\n  window.location.assign(url);\n}\n\n/**\n * Register a new user with username, name, email, and password.\n * Redirect the browser after successful signup based on the redirectTo value returned.\n * @param {Object} options\n */\nasync function signupWithPassword({ username, name, email, password }) {\n  const { data } = await axios.post(`${apiUrl}auth/create`, {\n    tenantId: store.tenantId,\n    username,\n    name,\n    email,\n    password,\n  });\n\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    setUser();\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\"Please try again.\");\n  }\n}\n\n/**\n * Log a user in via the provided method. This method serves to call other\n * methods, depending on the \"method\" parameter passed in.\n * @param {Object} options\n */\nasync function login({\n  method,\n  email,\n  username,\n  emailOrUsername,\n  password,\n  token,\n  uuid,\n}) {\n  if (!method) {\n    throw new Error('Userfront.login called without \"method\" property');\n  }\n  switch (method) {\n    case \"azure\":\n    case \"facebook\":\n    case \"github\":\n    case \"google\":\n    case \"linkedin\":\n      return loginWithSSO(method);\n    case \"password\":\n      return loginWithPassword({ email, username, emailOrUsername, password });\n    case \"link\":\n      return loginWithLink(token, uuid);\n    default:\n      throw new Error('Userfront.login called with invalid \"method\" property');\n  }\n}\n\n/**\n * Log a user in via SSO provider.\n * Redirect the browser after successful authentication and 302 redirect from server.\n * @param {String} provider Name of SSO provider\n */\nfunction loginWithSSO(provider) {\n  if (!provider) throw new Error(\"Missing provider\");\n  const url = getProviderLink(provider);\n  window.location.assign(url);\n}\n\n/**\n * Log a user in with email/username and password.\n * Redirect the browser after successful login based on the redirectTo value returned.\n * @param {Object} options\n */\nasync function loginWithPassword({\n  email,\n  username,\n  emailOrUsername,\n  password,\n}) {\n  const { data } = await axios.post(`${apiUrl}auth/basic`, {\n    tenantId: store.tenantId,\n    emailOrUsername: email || username || emailOrUsername,\n    password,\n  });\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    setUser();\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\"Please try again.\");\n  }\n}\n\n/**\n * Log a user in with a token/uuid combo passed into the function or\n * in the URL querystring. ?token=...&uuid=...\n * @param {String} token\n * @param {UUID} uuid\n */\nasync function loginWithLink(token, uuid) {\n  if (!token) token = getQueryAttr(\"token\");\n  if (!uuid) uuid = getQueryAttr(\"uuid\");\n  if (!token || !uuid) return;\n\n  const { data } = await axios.put(`${apiUrl}auth/link`, {\n    token,\n    uuid,\n    tenantId: store.tenantId,\n  });\n\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    setUser();\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\"Problem logging in.\");\n  }\n}\n\n/**\n * Send a login link to the provided email.\n * @param {String} email\n */\nasync function sendLoginLink(email) {\n  try {\n    const { data } = await axios.post(`${apiUrl}auth/link`, {\n      email,\n      tenantId: store.tenantId,\n    });\n    return data;\n  } catch (err) {\n    throw new Error(\"Problem sending link\");\n  }\n}\n\n/**\n * Send a password reset link to the provided email.\n * @param {String} email\n */\nasync function sendResetLink(email) {\n  try {\n    const { data } = await axios.post(`${apiUrl}auth/reset/link`, {\n      email,\n      tenantId: store.tenantId,\n    });\n    return data;\n  } catch (err) {\n    throw new Error(\"Problem sending link\");\n  }\n}\n\nasync function resetPassword({ uuid, token, password }) {\n  if (!token) token = getQueryAttr(\"token\");\n  if (!uuid) uuid = getQueryAttr(\"uuid\");\n  if (!token || !uuid) throw new Error(\"Missing token or uuid\");\n  const { data } = await axios.put(`${apiUrl}auth/reset`, {\n    tenantId: store.tenantId,\n    uuid,\n    token,\n    password,\n  });\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    setUser();\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\n      \"There was a problem resetting your password. Please try again.\"\n    );\n  }\n}\n\n// TODO replace with direct check of the access token.\n/**\n * If the access token is valid, redirect the browser to the\n * tenant's login redirection path (path after login).\n */\nasync function redirectIfLoggedIn() {\n  if (!store.accessToken) return removeAllCookies();\n  try {\n    const { data } = await axios.get(`${apiUrl}self`, {\n      headers: {\n        authorization: `Bearer ${store.accessToken}`,\n      },\n    });\n    if (data.tenant && data.tenant.loginRedirectPath) {\n      redirectToPath(data.tenant.loginRedirectPath);\n    }\n  } catch (err) {\n    removeAllCookies();\n  }\n}\n\n/**\n * Redirect to path portion of a URL.\n */\nfunction redirectToPath(pathOrUrl) {\n  try {\n    document;\n  } catch (error) {\n    return;\n  }\n  if (!pathOrUrl) return;\n  const el = document.createElement(\"a\");\n  el.href = pathOrUrl;\n  let path = `${el.pathname}${el.hash}${el.search}`;\n  if (el.pathname !== window.location.pathname) {\n    window.location.href = path;\n  }\n}\n\n/**\n * Log a user out and redirect to the logout path.\n */\nasync function logout() {\n  if (!store.accessToken) return removeAllCookies();\n  try {\n    const { data } = await axios.get(`${apiUrl}auth/logout`, {\n      headers: {\n        authorization: `Bearer ${store.accessToken}`,\n      },\n    });\n    removeAllCookies();\n    redirectToPath(data.redirectTo);\n  } catch (err) {\n    removeAllCookies();\n  }\n}\n\n/**\n * Set a cookie value based on the given options.\n * @param {String} value\n * @param {Object} options\n * @param {String} type\n */\nfunction setCookie(value, options, type) {\n  const cookieName = `${type}.${store.tenantId}`;\n  options = options || {\n    secure: store.mode === \"live\",\n    sameSite: \"Lax\",\n  };\n  if (type === \"refresh\") {\n    options.sameSite = \"Strict\";\n  }\n  Cookies.set(cookieName, value, options);\n}\n\n/**\n * Remove a cookie by name, regardless of its cookie setting(s).\n * @param {String} name\n */\nfunction removeCookie(name) {\n  Cookies.remove(name);\n  Cookies.remove(name, { secure: true, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: true, sameSite: \"None\" });\n  Cookies.remove(name, { secure: false, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: false, sameSite: \"None\" });\n}\n\n/**\n * Remove all auth cookies (access, id, refresh).\n */\nfunction removeAllCookies() {\n  removeCookie(store.accessTokenName);\n  removeCookie(store.idTokenName);\n  removeCookie(store.refreshTokenName);\n  store.accessToken = undefined;\n  store.idToken = undefined;\n  store.refreshToken = undefined;\n}\n\n/**\n * Define the store token values from the cookie values.\n */\nfunction setTokensFromCookies() {\n  store.accessToken = Cookies.get(store.accessTokenName);\n  store.idToken = Cookies.get(store.idTokenName);\n  store.refreshToken = Cookies.get(store.refreshTokenName);\n}\n\n/**\n * Set the cookies from a tokens object, and add to the local store.\n * @param {Object} tokens\n */\nfunction setCookiesAndTokens(tokens) {\n  setCookie(tokens.access.value, tokens.access.cookieOptions, \"access\");\n  setCookie(tokens.id.value, tokens.id.cookieOptions, \"id\");\n  setCookie(tokens.refresh.value, tokens.refresh.cookieOptions, \"refresh\");\n  setTokensFromCookies();\n}\n\n/**\n * Define user attributes & methods based on access & ID token.\n */\nasync function setUser() {\n  if (!store.idToken) {\n    throw new Error(\"ID token has not been set.\");\n  }\n  if (!store.accessToken) {\n    throw new Error(\"Access token has not been set.\");\n  }\n\n  try {\n    await verifyToken(store.idToken);\n  } catch (error) {\n    throw error;\n  }\n\n  Object.assign(\n    store.user,\n    createUser({\n      store,\n      afterUpdate: refresh,\n    })\n  );\n}\n\nasync function refresh() {\n  const res = await axios.get({\n    url: `${apiUrl}auth/refresh`,\n    headers: {\n      authorization: `Bearer ${store.accessToken}`,\n    },\n  });\n  if (!res || !res.data || !res.data.tokens) {\n    throw new Error(\"Problem refreshing tokens.\");\n  }\n\n  setCookiesAndTokens(res.data.tokens);\n  setUser();\n}\n\n/**\n * Register a window-level event called \"urlchanged\" that will fire\n * whenever the browser URL changes.\n */\nlet isRegistered = false;\nfunction registerUrlChangedEventListener() {\n  if (isRegistered) return;\n  isRegistered = true;\n  try {\n    history.pushState = ((f) =>\n      function pushState() {\n        var ret = f.apply(this, arguments);\n        window.dispatchEvent(new Event(\"pushstate\"));\n        window.dispatchEvent(new Event(\"urlchanged\"));\n        return ret;\n      })(history.pushState);\n\n    history.replaceState = ((f) =>\n      function replaceState() {\n        var ret = f.apply(this, arguments);\n        window.dispatchEvent(new Event(\"replacestate\"));\n        window.dispatchEvent(new Event(\"urlchanged\"));\n        return ret;\n      })(history.replaceState);\n\n    window.addEventListener(\"popstate\", () => {\n      window.dispatchEvent(new Event(\"urlchanged\"));\n    });\n  } catch (error) {}\n}\n\nexport default {\n  addInitCallback,\n  accessToken,\n  getQueryAttr,\n  idToken,\n  init,\n  isTestHostname,\n  login,\n  logout,\n  redirectIfLoggedIn,\n  refresh,\n  registerUrlChangedEventListener,\n  resetPassword,\n  sendLoginLink,\n  sendResetLink,\n  setMode,\n  setCookie,\n  signup,\n  store,\n  get user() {\n    return store.user;\n  },\n  verifyToken,\n};\n","import axios from \"axios\";\nimport jwt from \"jsonwebtoken\";\nimport { apiUrl } from \"./constants.js\";\n\n/**\n * Create a user object based on ID token\n * @param {Object} options\n * @property {Object} options.store Userfront store\n * @property {Function} options.afterUpdate Function to call after update is finished\n * @returns {Object}\n */\nexport default ({ store, afterUpdate }) => {\n  if (!store.idToken) {\n    throw new Error(\"User: Missing ID token\");\n  }\n  if (!store.accessToken) {\n    throw new Error(\"User: Missing access token\");\n  }\n\n  const user = {};\n  const decodedIdToken = jwt.decode(store.idToken);\n\n  // Set basic user information properties from ID token\n  const idTokenProps = [\n    \"email\",\n    \"username\",\n    \"name\",\n    \"image\",\n    \"data\",\n    \"confirmedAt\",\n    \"createdAt\",\n    \"updatedAt\",\n    \"mode\",\n    \"userId\",\n    \"userUuid\",\n    \"tenantId\",\n    \"isConfirmed\",\n  ];\n  for (const prop of idTokenProps) {\n    user[prop] = decodedIdToken[prop];\n  }\n  return {\n    ...user,\n    /**\n     * Update user information via Userfront API\n     * @param {Object} updates User properties to update e.g. { name: 'John Doe' }\n     * @returns {Promise<void>}\n     */\n    async update(updates) {\n      if (!decodedIdToken.userId) {\n        throw new Error(\"API resource update error: Missing ID\");\n      }\n      if (!updates || Object.keys(updates).length < 1) {\n        throw new Error(\"Missing user properties to update\");\n      }\n\n      try {\n        await axios.put({\n          url: `${apiUrl}tenants/${store.tenantId}/users/${decodedIdToken.userId}`,\n          headers: {\n            authorization: `Bearer ${store.accessToken}`,\n          },\n          payload: updates,\n        });\n      } catch (error) {\n        throw new Error(error.message);\n      }\n\n      if (afterUpdate && typeof afterUpdate === \"function\") {\n        afterUpdate();\n      }\n\n      return Promise.resolve();\n    },\n  };\n};\n"],"names":["apiUrl","privateIPRegex","_catch","body","recover","result","e","then","refresh","axios","get","url","headers","authorization","store","accessToken","res","data","tokens","Error","setCookiesAndTokens","setUser","Object","assign","user","afterUpdate","idToken","decodedIdToken","jwt","decode","idTokenProps","prop","update","updates","Promise","resolve","userId","keys","length","put","tenantId","payload","error","message","createUser","verifyToken","token","publicKey","verify","decodedToken","complete","header","kid","client","JwksClient","jwksUri","mode","requestHeaders","origin","window","location","getSigningKey","key","getPublicKey","initCallbacks","isTestHostname","hn","hostname","match","err","getQueryAttr","attrName","href","indexOf","decodeURIComponent","split","getProviderLink","provider","redirect","encodeURIComponent","redirectToPath","pathOrUrl","document","el","createElement","pathname","hash","search","setCookie","value","options","type","cookieName","secure","sameSite","Cookies","set","removeCookie","name","remove","removeAllCookies","accessTokenName","idTokenName","refreshTokenName","undefined","refreshToken","setTokensFromCookies","access","cookieOptions","id","isRegistered","addInitCallback","cb","push","init","console","warn","forEach","login","method","email","username","emailOrUsername","password","uuid","loginWithSSO","post","redirectTo","loginWithPassword","loginWithLink","logout","redirectIfLoggedIn","tenant","loginRedirectPath","registerUrlChangedEventListener","history","pushState","f","ret","apply","this","arguments","dispatchEvent","Event","replaceState","addEventListener","resetPassword","sendLoginLink","sendResetLink","setMode","signup","signupWithSSO","signupWithPassword"],"mappings":"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"}
=======
{"version":3,"file":"userfront-core.js","sources":["../src/constants.js","../src/utils.js","../src/store.js","../src/tokens.js","../src/cookies.js","../src/url.js","../src/signon.js","../src/iframe.js","../src/index.js","../src/logout.js","../src/mode.js"],"sourcesContent":["export const apiUrl = `https://api.userfront.com/v0/`;\n\nexport const privateIPRegex = /((^127\\.)|(^10\\.)|(^172\\.1[6-9]\\.)|(^172\\.2[0-9]\\.)|(^172\\.3[0-1]\\.)|(^192\\.168\\.))\\d{1,3}\\.\\d{1,3}/g;\n","/**\n * This file is for zero-dependency utilities that can\n * be imported by any other file. Don't add any imports\n * to this file other than constants\n */\n\nimport { privateIPRegex } from \"./constants.js\";\n\n/**\n * Determine whether a hostname is in test mode.\n * @param {String} hn\n */\nexport function isTestHostname(hn) {\n  try {\n    const hostname = hn || window.location.hostname;\n    return !!(hostname.match(/localhost/g) || hostname.match(privateIPRegex));\n  } catch (err) {\n    return true;\n  }\n}\n","import { isTestHostname } from \"./utils.js\";\n\nexport const store = {\n  mode: isTestHostname() ? \"test\" : \"live\",\n};\n","import Cookies from \"js-cookie\";\n\nimport { store } from \"./store.js\";\n\n/**\n * Set and then return the access token\n */\nexport function accessToken() {\n  store.accessToken = Cookies.get(store.accessTokenName);\n  return store.accessToken;\n}\n\n/**\n * Set and then return the ID token\n */\nexport function idToken() {\n  store.idToken = Cookies.get(store.idTokenName);\n  return store.idToken;\n}\n\n/**\n * Define the store token values from the cookie values.\n */\nexport function setTokensFromCookies() {\n  store.accessToken = Cookies.get(store.accessTokenName);\n  store.idToken = Cookies.get(store.idTokenName);\n  store.refreshToken = Cookies.get(store.refreshTokenName);\n}\n","import Cookies from \"js-cookie\";\nimport { store } from \"./store.js\";\nimport { setTokensFromCookies } from \"./tokens.js\";\n\n/**\n * Set a cookie value based on the given options.\n * @param {String} value\n * @param {Object} options\n * @param {String} type\n */\nexport function setCookie(value, options, type) {\n  const cookieName = `${type}.${store.tenantId}`;\n  options = options || {\n    secure: store.mode === \"live\",\n    sameSite: \"Lax\",\n  };\n  if (type === \"refresh\") {\n    options.sameSite = \"Strict\";\n  }\n  Cookies.set(cookieName, value, options);\n}\n\n/**\n * Remove a cookie by name, regardless of its cookie setting(s).\n * @param {String} name\n */\nfunction removeCookie(name) {\n  Cookies.remove(name);\n  Cookies.remove(name, { secure: true, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: true, sameSite: \"None\" });\n  Cookies.remove(name, { secure: false, sameSite: \"Lax\" });\n  Cookies.remove(name, { secure: false, sameSite: \"None\" });\n}\n\n/**\n * Remove all auth cookies (access, id, refresh).\n */\nexport function removeAllCookies() {\n  removeCookie(store.accessTokenName);\n  removeCookie(store.idTokenName);\n  removeCookie(store.refreshTokenName);\n  store.accessToken = undefined;\n  store.idToken = undefined;\n  store.refreshToken = undefined;\n}\n\n/**\n * Set the cookies from a tokens object, and add to the local store.\n * @param {Object} tokens\n */\nexport function setCookiesAndTokens(tokens) {\n  setCookie(tokens.access.value, tokens.access.cookieOptions, \"access\");\n  setCookie(tokens.id.value, tokens.id.cookieOptions, \"id\");\n  setCookie(tokens.refresh.value, tokens.refresh.cookieOptions, \"refresh\");\n  setTokensFromCookies();\n}\n","import axios from \"axios\";\n\nimport { apiUrl } from \"./constants.js\";\nimport { store } from \"./store.js\";\nimport { removeAllCookies } from \"./cookies.js\";\n\n/**\n * Get the value of a query attribute, e.g. ?attr=value\n * @param {String} attrName\n */\nexport function getQueryAttr(attrName) {\n  if (\n    !window.location.href ||\n    window.location.href.indexOf(`${attrName}=`) < 0\n  ) {\n    return;\n  }\n  return decodeURIComponent(\n    window.location.href.split(`${attrName}=`)[1].split(\"&\")[0]\n  );\n}\n\n// TODO replace with direct check of the access token.\n/**\n * If the access token is valid, redirect the browser to the\n * tenant's login redirection path (path after login).\n */\nexport async function redirectIfLoggedIn() {\n  if (!store.accessToken) {\n    return removeAllCookies();\n  }\n  if (getQueryAttr(\"redirect\")) {\n    return redirectToPath(getQueryAttr(\"redirect\"));\n  }\n\n  try {\n    const { data } = await axios.get(`${apiUrl}self`, {\n      headers: {\n        authorization: `Bearer ${store.accessToken}`,\n      },\n    });\n    if (data.tenant && data.tenant.loginRedirectPath) {\n      redirectToPath(data.tenant.loginRedirectPath);\n    }\n  } catch (err) {\n    removeAllCookies();\n  }\n}\n\n/**\n * Redirect to path portion of a URL.\n */\nexport function redirectToPath(pathOrUrl) {\n  try {\n    document;\n  } catch (error) {\n    return;\n  }\n  if (!pathOrUrl) return;\n  const el = document.createElement(\"a\");\n  el.href = pathOrUrl;\n  let path = `${el.pathname}${el.hash}${el.search}`;\n  if (el.pathname !== window.location.pathname) {\n    window.location.assign(path);\n  }\n}\n","import { store } from \"./store.js\";\nimport { getQueryAttr } from \"./url.js\";\n\n/**\n * This file has methods for signing up and logging in\n */\n\n/**\n * Register a user via the provided method. This method serves to call other\n * methods, depending on the \"method\" parameter passed in.\n * @param {Object} options\n */\nexport async function signup({ method, username, name, email, password }) {\n  if (!method) {\n    throw new Error('Userfront.signup called without \"method\" property');\n  }\n  switch (method) {\n    case \"azure\":\n    case \"facebook\":\n    case \"github\":\n    case \"google\":\n    case \"linkedin\":\n      return signupWithSSO(method);\n    case \"password\":\n      return signupWithPassword({ username, name, email, password });\n    default:\n      throw new Error('Userfront.signup called with invalid \"method\" property');\n  }\n}\n\n/**\n * Register a new user in via SSO provider.\n * Redirect the browser after successful authentication and 302 redirect from server.\n * @param {String} provider Name of SSO provider\n */\nfunction signupWithSSO(provider) {\n  if (!provider) throw new Error(\"Missing provider\");\n  const url = getProviderLink(provider);\n  window.location.assign(url);\n}\n\n/**\n * Register a new user with username, name, email, and password.\n * Redirect the browser after successful signup based on the redirectTo value returned.\n * @param {Object} options\n */\nasync function signupWithPassword({ username, name, email, password }) {\n  const { data } = await axios.post(`${apiUrl}auth/create`, {\n    tenantId: store.tenantId,\n    username,\n    name,\n    email,\n    password,\n  });\n\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\"Please try again.\");\n  }\n}\n\n/**\n * Log a user in via the provided method. This method serves to call other\n * methods, depending on the \"method\" parameter passed in.\n * @param {Object} options\n */\nexport async function login({\n  method,\n  email,\n  username,\n  emailOrUsername,\n  password,\n  token,\n  uuid,\n}) {\n  if (!method) {\n    throw new Error('Userfront.login called without \"method\" property');\n  }\n  switch (method) {\n    case \"azure\":\n    case \"facebook\":\n    case \"github\":\n    case \"google\":\n    case \"linkedin\":\n      return loginWithSSO(method);\n    case \"password\":\n      return loginWithPassword({ email, username, emailOrUsername, password });\n    case \"link\":\n      return loginWithLink(token, uuid);\n    default:\n      throw new Error('Userfront.login called with invalid \"method\" property');\n  }\n}\n\n/**\n * Log a user in via SSO provider.\n * Redirect the browser after successful authentication and 302 redirect from server.\n * @param {String} provider Name of SSO provider\n */\nfunction loginWithSSO(provider) {\n  if (!provider) throw new Error(\"Missing provider\");\n  const url = getProviderLink(provider);\n  window.location.assign(url);\n}\n\nfunction getProviderLink(provider) {\n  if (!provider) throw new Error(\"Missing provider\");\n  if (!store.tenantId) throw new Error(\"Missing tenant ID\");\n\n  let url = `https://api.userfront.com/v0/auth/${provider}/login?tenant_id=${store.tenantId}&origin=${window.location.origin}`;\n\n  const redirect = getQueryAttr(\"redirect\");\n  if (redirect) {\n    url += `&redirect=${encodeURIComponent(redirect)}`;\n  }\n\n  return url;\n}\n\n/**\n * Log a user in with email/username and password.\n * Redirect the browser after successful login based on the redirectTo value returned.\n * @param {Object} options\n */\nasync function loginWithPassword({\n  email,\n  username,\n  emailOrUsername,\n  password,\n}) {\n  const { data } = await axios.post(`${apiUrl}auth/basic`, {\n    tenantId: store.tenantId,\n    emailOrUsername: email || username || emailOrUsername,\n    password,\n  });\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\"Please try again.\");\n  }\n}\n\n/**\n * Log a user in with a token/uuid combo passed into the function or\n * in the URL querystring. ?token=...&uuid=...\n * @param {String} token\n * @param {UUID} uuid\n */\nasync function loginWithLink(token, uuid) {\n  if (!token) token = getQueryAttr(\"token\");\n  if (!uuid) uuid = getQueryAttr(\"uuid\");\n  if (!token || !uuid) return;\n\n  const { data } = await axios.put(`${apiUrl}auth/link`, {\n    token,\n    uuid,\n    tenantId: store.tenantId,\n  });\n\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\"Problem logging in.\");\n  }\n}\n\n/**\n * Send a login link to the provided email.\n * @param {String} email\n */\nexport async function sendLoginLink(email) {\n  try {\n    const { data } = await axios.post(`${apiUrl}auth/link`, {\n      email,\n      tenantId: store.tenantId,\n    });\n    return data;\n  } catch (err) {\n    throw new Error(\"Problem sending link\");\n  }\n}\n\n/**\n * Send a password reset link to the provided email.\n * @param {String} email\n */\nexport async function sendResetLink(email) {\n  try {\n    const { data } = await axios.post(`${apiUrl}auth/reset/link`, {\n      email,\n      tenantId: store.tenantId,\n    });\n    return data;\n  } catch (err) {\n    throw new Error(\"Problem sending link\");\n  }\n}\n\nexport async function resetPassword({ uuid, token, password }) {\n  if (!token) token = getQueryAttr(\"token\");\n  if (!uuid) uuid = getQueryAttr(\"uuid\");\n  if (!token || !uuid) throw new Error(\"Missing token or uuid\");\n  const { data } = await axios.put(`${apiUrl}auth/reset`, {\n    tenantId: store.tenantId,\n    uuid,\n    token,\n    password,\n  });\n  if (data.tokens) {\n    setCookiesAndTokens(data.tokens);\n    redirectToPath(getQueryAttr(\"redirect\") || data.redirectTo || \"/\");\n  } else {\n    throw new Error(\n      \"There was a problem resetting your password. Please try again.\"\n    );\n  }\n}\n","import { setCookiesAndTokens } from \"./cookies.js\";\n\nconst frameUrl = \"https://auth.userfront.net\";\nconst frameId = \"uf-auth-frame\";\n\nlet iframe;\n\n/**\n * Add the auth iframe to the document body, if the iframe\n * has not been added already.\n */\nexport function setIframe() {\n  try {\n    if (iframe) return;\n    iframe = document.createElement(\"iframe\");\n    iframe.src = frameUrl;\n    iframe.id = frameId;\n    iframe.style.width = \"0px\";\n    iframe.style.height = \"0px\";\n    iframe.style.display = \"none\";\n    document.body.appendChild(iframe);\n    addIframeMessageListener();\n  } catch (error) {}\n}\n\n/**\n * Return the iframe element\n */\nexport function getIframe() {\n  return iframe;\n}\n\n/**\n * Separated this call out from addIframeMessageListener\n * in order to make it testable.\n *\n * @param {*} e - iframe event\n */\nexport function triageEvent(e) {\n  if (!e || e.origin !== frameUrl || !e.data || !e.data.type) return;\n  if (e.data.status !== 200 && e.data.type !== \"logout\") {\n    return console.warn(`Problem with ${e.data.type} request.`);\n  }\n\n  switch (e.data.type) {\n    case \"exchange\":\n      console.log(\"exchange\");\n      break;\n    case \"refresh\":\n      setCookiesAndTokens(e.data.body.tokens);\n      break;\n    case \"logout\":\n      console.log(\"logout\");\n      break;\n    default:\n      return;\n  }\n}\n\n/**\n * Add an event listener to the window that will accept messages\n * from the iframe.\n */\nfunction addIframeMessageListener() {\n  try {\n    window.addEventListener(\"message\", triageEvent);\n  } catch (error) {}\n}\n","import { store } from \"./store.js\";\nimport { accessToken, idToken, setTokensFromCookies } from \"./tokens\";\nimport { redirectIfLoggedIn } from \"./url.js\";\nimport {\n  login,\n  resetPassword,\n  sendLoginLink,\n  sendResetLink,\n  signup,\n} from \"./signon.js\";\nimport { logout } from \"./logout.js\";\nimport { setMode } from \"./mode.js\";\nimport { setIframe } from \"./iframe.js\";\nimport { isTestHostname } from \"./utils.js\";\n\nlet initCallbacks = [];\n\n/**\n * Initialize the Userfront library.\n * @param {String} tenantId\n */\nfunction init(tenantId) {\n  if (!tenantId) return console.warn(\"Userfront initialized without tenant ID\");\n  store.tenantId = tenantId;\n  store.accessTokenName = `access.${tenantId}`;\n  store.idTokenName = `id.${tenantId}`;\n  store.refreshTokenName = `refresh.${tenantId}`;\n  setIframe();\n  setTokensFromCookies();\n  try {\n    if (initCallbacks.length > 0) {\n      initCallbacks.forEach((cb) => {\n        if (!cb || typeof cb !== \"function\") return;\n        cb({ tenantId });\n      });\n    }\n    initCallbacks = [];\n  } catch (error) {}\n}\n\n/**\n * Add a callback function to be called upon Userfront.init()\n * @param {Function} cb\n */\nfunction addInitCallback(cb) {\n  if (!cb || typeof cb !== \"function\") return;\n  initCallbacks.push(cb);\n}\n\n/**\n * Register a window-level event called \"urlchanged\" that will fire\n * whenever the browser URL changes.\n */\nlet isRegistered = false;\nfunction registerUrlChangedEventListener() {\n  if (isRegistered) return;\n  isRegistered = true;\n  try {\n    history.pushState = ((f) =>\n      function pushState() {\n        var ret = f.apply(this, arguments);\n        window.dispatchEvent(new Event(\"pushstate\"));\n        window.dispatchEvent(new Event(\"urlchanged\"));\n        return ret;\n      })(history.pushState);\n\n    history.replaceState = ((f) =>\n      function replaceState() {\n        var ret = f.apply(this, arguments);\n        window.dispatchEvent(new Event(\"replacestate\"));\n        window.dispatchEvent(new Event(\"urlchanged\"));\n        return ret;\n      })(history.replaceState);\n\n    window.addEventListener(\"popstate\", () => {\n      window.dispatchEvent(new Event(\"urlchanged\"));\n    });\n  } catch (error) {}\n}\n\n/**\n * EXPORTS\n */\n\n// export { logout } from \"./logout.js\";\n// export { setMode } from \"./mode\";\n// export {\n//   login,\n//   resetPassword,\n//   sendLoginLink,\n//   sendResetLink,\n//   signup,\n// } from \"./signon.js\";\n// export { store } from \"./store\";\n// export { accessToken, idToken } from \"./tokens\";\n// export { redirectIfLoggedIn } from \"./url.js\";\n// export { isTestHostname } from \"./utils.js\";\n\nexport default {\n  // index\n  addInitCallback,\n  init,\n  registerUrlChangedEventListener,\n\n  //logout\n  logout,\n\n  // mode\n  setMode,\n\n  // signon\n  login,\n  resetPassword,\n  sendLoginLink,\n  sendResetLink,\n  signup,\n\n  // store\n  store,\n\n  // tokens\n  accessToken,\n  idToken,\n\n  // url\n  redirectIfLoggedIn,\n\n  // utils\n  isTestHostname,\n};\n","import axios from \"axios\";\n\nimport { apiUrl } from \"./constants\";\nimport { store } from \"./store.js\";\nimport { removeAllCookies } from \"./cookies.js\";\nimport { redirectToPath } from \"./url\";\n\n/**\n * Log a user out and redirect to the logout path.\n */\nexport async function logout() {\n  if (!store.accessToken) return removeAllCookies();\n  try {\n    const { data } = await axios.get(`${apiUrl}auth/logout`, {\n      headers: {\n        authorization: `Bearer ${store.accessToken}`,\n      },\n    });\n    removeAllCookies();\n    redirectToPath(data.redirectTo);\n  } catch (err) {\n    removeAllCookies();\n  }\n}\n","import axios from \"axios\";\n\nimport { apiUrl } from \"./constants.js\";\nimport { store } from \"./store.js\";\n\n/**\n * Define the mode of operation (live or test)\n */\nexport async function setMode() {\n  try {\n    const { data } = await axios.get(`${apiUrl}tenants/${store.tenantId}/mode`);\n    store.mode = data.mode || \"test\";\n  } catch (err) {\n    store.mode = \"test\";\n  }\n}\n"],"names":["apiUrl","privateIPRegex","isTestHostname","hn","hostname","window","location","match","err","store","mode","setTokensFromCookies","accessToken","Cookies","get","accessTokenName","idToken","idTokenName","refreshToken","refreshTokenName","setCookie","value","options","type","cookieName","tenantId","secure","sameSite","set","removeCookie","name","remove","removeAllCookies","undefined","getQueryAttr","attrName","href","indexOf","decodeURIComponent","split","redirectToPath","pathOrUrl","document","error","el","createElement","pathname","assign","hash","search","body","recover","result","e","then","getProviderLink","provider","Error","url","origin","redirect","encodeURIComponent","frameUrl","iframe","triageEvent","data","status","console","warn","log","tokens","access","cookieOptions","id","refresh","initCallbacks","isRegistered","addInitCallback","cb","push","init","src","style","width","height","display","appendChild","addEventListener","addIframeMessageListener","setIframe","length","forEach","registerUrlChangedEventListener","history","pushState","f","ret","apply","this","arguments","dispatchEvent","Event","replaceState","logout","axios","headers","authorization","redirectTo","setMode","login","method","email","username","emailOrUsername","password","token","uuid","loginWithSSO","post","setCookiesAndTokens","loginWithPassword","put","loginWithLink","resetPassword","sendLoginLink","sendResetLink","signup","signupWithSSO","signupWithPassword","redirectIfLoggedIn","tenant","loginRedirectPath"],"mappings":"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"}
>>>>>>> main
