import e from"axios";import t from"js-cookie";let r={apiUrl:"https://api.userfront.com/v0/",privateIPRegex:/((^127\.)|(^10\.)|(^172\.1[6-9]\.)|(^172\.2[0-9]\.)|(^172\.3[0-1]\.)|(^192\.168\.))\d{1,3}\.\d{1,3}/g};function n(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}const o=function(){try{if(!M("store").accessToken)return Promise.resolve(M("removeAllCookies")());const e=n(function(){return Promise.resolve(M("axios").get(M("apiUrl")+"auth/logout",{headers:{authorization:"Bearer "+M("store").accessToken}})).then(function({data:e}){M("removeAllCookies")(),M("redirectToPath")(e.redirectTo)})},function(){});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},s=function(){try{if(!M("store").accessToken)return Promise.resolve(M("removeAllCookies")());const e=n(function(){return Promise.resolve(M("axios").get(M("apiUrl")+"self",{headers:{authorization:"Bearer "+M("store").accessToken}})).then(function({data:e}){e.tenant&&e.tenant.loginRedirectPath&&M("redirectToPath")(e.tenant.loginRedirectPath)})},function(){M("removeAllCookies")()});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},i=function({uuid:e,token:t,password:r}){try{if(t||(t=M("getQueryAttr")("token")),e||(e=M("getQueryAttr")("uuid")),!t||!e)throw new Error("Missing token or uuid");return Promise.resolve(M("axios").put(M("apiUrl")+"auth/reset",{tenantId:M("store").tenantId,uuid:e,token:t,password:r})).then(function({data:e}){if(!e.tokens)throw new Error("There was a problem resetting your password. Please try again.");M("setCookiesAndTokens")(e.tokens),M("redirectToPath")(M("getQueryAttr")("redirect")||e.redirectTo||"/")})}catch(e){return Promise.reject(e)}},a=function(e){try{return Promise.resolve(n(function(){return Promise.resolve(M("axios").post(M("apiUrl")+"auth/reset/link",{email:e,tenantId:M("store").tenantId})).then(function({data:e}){return e})},function(){throw new Error("Problem sending link")}))}catch(e){return Promise.reject(e)}},c=function(e){try{return Promise.resolve(n(function(){return Promise.resolve(M("axios").post(M("apiUrl")+"auth/link",{email:e,tenantId:M("store").tenantId})).then(function({data:e}){return e})},function(){throw new Error("Problem sending link")}))}catch(e){return Promise.reject(e)}},u=function(e,t){try{return e||(e=M("getQueryAttr")("token")),t||(t=M("getQueryAttr")("uuid")),e&&t?Promise.resolve(M("axios").put(M("apiUrl")+"auth/link",{token:e,uuid:t,tenantId:M("store").tenantId})).then(function({data:e}){if(!e.tokens)throw new Error("Problem logging in.");M("setCookiesAndTokens")(e.tokens),M("redirectToPath")(M("getQueryAttr")("redirect")||e.redirectTo||"/")}):Promise.resolve()}catch(e){return Promise.reject(e)}},d=function({email:e,username:t,emailOrUsername:r,password:n}){try{return Promise.resolve(M("axios").post(M("apiUrl")+"auth/basic",{tenantId:M("store").tenantId,emailOrUsername:e||t||r,password:n})).then(function({data:e}){if(!e.tokens)throw new Error("Please try again.");M("setCookiesAndTokens")(e.tokens),M("redirectToPath")(M("getQueryAttr")("redirect")||e.redirectTo||"/")})}catch(e){return Promise.reject(e)}},l=function({method:e,email:t,username:r,emailOrUsername:n,password:o,token:s,uuid:i}){try{if(!e)throw new Error('Userfront.login called without "method" property');switch(e){case"azure":case"facebook":case"github":case"google":case"linkedin":return Promise.resolve(M("loginWithSSO")(e));case"password":return Promise.resolve(M("loginWithPassword")({email:t,username:r,emailOrUsername:n,password:o}));case"link":return Promise.resolve(M("loginWithLink")(s,i));default:throw new Error('Userfront.login called with invalid "method" property')}}catch(e){return Promise.reject(e)}},h=function({username:e,name:t,email:r,password:n}){try{return Promise.resolve(M("axios").post(M("apiUrl")+"auth/create",{tenantId:M("store").tenantId,username:e,name:t,email:r,password:n})).then(function({data:e}){if(!e.tokens)throw new Error("Please try again.");M("setCookiesAndTokens")(e.tokens),M("redirectToPath")(M("getQueryAttr")("redirect")||e.redirectTo||"/")})}catch(e){return Promise.reject(e)}},_=function({method:e,username:t,name:r,email:n,password:o}){try{if(!e)throw new Error('Userfront.signup called without "method" property');switch(e){case"azure":case"facebook":case"github":case"google":case"linkedin":return Promise.resolve(M("signupWithSSO")(e));case"password":return Promise.resolve(M("signupWithPassword")({username:t,name:r,email:n,password:o}));default:throw new Error('Userfront.signup called with invalid "method" property')}}catch(e){return Promise.reject(e)}},f=function(){try{const e=n(function(){return Promise.resolve(M("axios").get(`${M("apiUrl")}tenants/${M("store").tenantId}/mode`)).then(function({data:e}){M("store").mode=e.mode||"test"})},function(){M("store").mode="test"});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},{apiUrl:m,privateIPRegex:k}=M("constants"),w=e=>{try{const t=e||window.location.hostname;return!(!t.match(/localhost/g)&&!t.match(M("privateIPRegex")))}catch(e){return!0}},g={mode:M("isTestHostname")()?"test":"live"};function p(e){if(!e)return console.warn("Userfront initialized without tenant ID");M("store").tenantId=e,M("store").accessTokenName="access."+e,M("store").idTokenName="id."+e,M("store").refreshTokenName="refresh."+e,M("setTokensFromCookies")()}function v(){return M("store").accessToken=M("Cookies").get(M("store").accessTokenName),M("store").accessToken}function T(){return M("store").idToken=M("Cookies").get(M("store").idTokenName),M("store").idToken}function P(e){if(window.location.href&&!(window.location.href.indexOf(e+"=")<0))return decodeURIComponent(window.location.href.split(e+"=")[1].split("&")[0])}function E(e){if(!e)throw new Error("Missing provider");if(!M("store").tenantId)throw new Error("Missing tenant ID");return`https://api.userfront.com/v0/auth/${e}/login?tenant_id=${M("store").tenantId}&origin=${window.location.origin}&pathname=${window.location.pathname}`}function y(e){if(!e)throw new Error("Missing provider");const t=M("getProviderLink")(e);window.location.assign(t)}function I(e){if(!e)throw new Error("Missing provider");const t=M("getProviderLink")(e);window.location.assign(t)}function R(e){if(!e)return;const t=document.createElement("a");t.href=e,t.pathname!==window.location.pathname&&(window.location.href=`${t.pathname}${t.hash}${t.search}`)}function L(e,t,r){const n=`${r}.${M("store").tenantId}`;t=t||{secure:"live"===M("store").mode,sameSite:"Lax"},"refresh"===r&&(t.sameSite="Strict"),M("Cookies").set(n,e,t)}function C(e){M("Cookies").remove(e),M("Cookies").remove(e,{secure:!0,sameSite:"Lax"}),M("Cookies").remove(e,{secure:!0,sameSite:"None"}),M("Cookies").remove(e,{secure:!1,sameSite:"Lax"}),M("Cookies").remove(e,{secure:!1,sameSite:"None"})}function O(){M("removeCookie")(M("store").accessTokenName),M("removeCookie")(M("store").idTokenName),M("removeCookie")(M("store").refreshTokenName),M("store").accessToken=void 0,M("store").idToken=void 0,M("store").refreshToken=void 0}function A(){M("store").accessToken=M("Cookies").get(M("store").accessTokenName),M("store").idToken=M("Cookies").get(M("store").idTokenName),M("store").refreshToken=M("Cookies").get(M("store").refreshTokenName)}function U(e){M("setCookie")(e.access.value,e.access.cookieOptions,"access"),M("setCookie")(e.id.value,e.id.cookieOptions,"id"),M("setCookie")(e.refresh.value,e.refresh.cookieOptions,"refresh"),M("setTokensFromCookies")()}let b=!1;function N(){if(!M("isRegistered")){!function(e,t){let r=W();void 0===r.isRegistered?b=!0:r.isRegistered=!0}();try{history.pushState=(e=history.pushState,function(){var t=e.apply(this,arguments);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("urlchanged")),t}),history.replaceState=(e=>function(){var t=e.apply(this,arguments);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("urlchanged")),t})(history.replaceState),window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("urlchanged"))})}catch(e){}var e}}let $={accessToken:M("accessToken"),getQueryAttr:M("getQueryAttr"),idToken:M("idToken"),init:M("init"),isTestHostname:M("isTestHostname"),login:M("login"),logout:M("logout"),redirectIfLoggedIn:M("redirectIfLoggedIn"),registerUrlChangedEventListener:M("registerUrlChangedEventListener"),resetPassword:M("resetPassword"),sendLoginLink:M("sendLoginLink"),sendResetLink:M("sendResetLink"),setMode:M("setMode"),setCookie:M("setCookie"),signup:M("signup"),store:M("store")};function j(){try{if(global)return global}catch(e){try{if(window)return window}catch(e){return this}}}var S=null;function x(){if(null===S){let e=j();e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__||(e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__=0),S=__$$GLOBAL_REWIRE_NEXT_MODULE_ID__++}return S}function D(){let e=j();return e.__$$GLOBAL_REWIRE_REGISTRY__||(e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)),e.__$$GLOBAL_REWIRE_REGISTRY__}function W(){let e=x(),t=D(),r=t[e];return r||(t[e]=Object.create(null),r=t[e]),r}!function(){let e=j();e.__rewire_reset_all__||(e.__rewire_reset_all__=function(){e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)})}();let G={};function M(n){let $=W();if(void 0===$[n])return function(n){switch(n){case"constants":return r;case"privateIPRegex":return k;case"isTestHostname":return w;case"store":return g;case"setTokensFromCookies":return A;case"Cookies":return t;case"axios":return e;case"apiUrl":return m;case"signupWithSSO":return y;case"signupWithPassword":return h;case"getProviderLink":return E;case"setCookiesAndTokens":return U;case"redirectToPath":return R;case"getQueryAttr":return P;case"loginWithSSO":return I;case"loginWithPassword":return d;case"loginWithLink":return u;case"removeAllCookies":return O;case"removeCookie":return C;case"setCookie":return L;case"isRegistered":return b;case"accessToken":return v;case"idToken":return T;case"init":return p;case"login":return l;case"logout":return o;case"redirectIfLoggedIn":return s;case"registerUrlChangedEventListener":return N;case"resetPassword":return i;case"sendLoginLink":return c;case"sendResetLink":return a;case"setMode":return f;case"signup":return _}}(n);var j=$[n];return"__INTENTIONAL_UNDEFINED__"===j?void 0:j}function Q(e,t){let r=W();return"object"==typeof e?(Object.keys(e).forEach(function(t){r[t]=e[t]}),function(){Object.keys(e).forEach(function(t){B(e)})}):(r[e]=void 0===t?"__INTENTIONAL_UNDEFINED__":t,function(){B(e)})}function B(e){let t=W();delete t[e],0==Object.keys(t).length&&delete D()[x]}function z(e){let t=W();var r=Object.keys(e),n={};function o(){r.forEach(function(e){t[e]=n[e]})}return function(s){r.forEach(function(r){n[r]=t[r],t[r]=e[r]});let i=s();return i&&"function"==typeof i.then?i.then(o).catch(o):o(),i}}!function(){function e(e,t){Object.defineProperty(G,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",M),e("__GetDependency__",M),e("__Rewire__",Q),e("__set__",Q),e("__reset__",B),e("__ResetDependency__",B),e("__with__",z)}();let F=typeof $;function H(e,t){Object.defineProperty($,e,{value:t,enumerable:!1,configurable:!0})}"object"!==F&&"function"!==F||!Object.isExtensible($)||(H("__get__",M),H("__GetDependency__",M),H("__Rewire__",Q),H("__set__",Q),H("__reset__",B),H("__ResetDependency__",B),H("__with__",z),H("__RewireAPI__",G));export default $;export{M as __GetDependency__,B as __ResetDependency__,G as __RewireAPI__,Q as __Rewire__,M as __get__,Q as __set__};
//# sourceMappingURL=userfront-core.module.js.map
