import e from"axios";import t from"js-cookie";let r={apiUrl:"https://api.userfront.com/v0/",privateIPRegex:/((^127\.)|(^10\.)|(^172\.1[6-9]\.)|(^172\.2[0-9]\.)|(^172\.3[0-1]\.)|(^192\.168\.))\d{1,3}\.\d{1,3}/g};const{apiUrl:n,privateIPRegex:o}=j("constants"),s=e=>{try{const t=e||window.location.hostname;return!(!t.match(/localhost/g)&&!t.match(j("privateIPRegex")))}catch(e){return!0}},i={mode:j("isTestHostname")()?"test":"live"};function a(e){if(!e)return console.warn("Userfront initialized without tenant ID");j("store").tenantId=e,j("store").accessTokenName="access."+e,j("store").idTokenName="id."+e,j("store").refreshTokenName="refresh."+e,j("setTokensFromCookies")()}function c(){return j("store").accessToken=j("Cookies").get(j("store").accessTokenName),j("store").accessToken}function u(){return j("store").idToken=j("Cookies").get(j("store").idTokenName),j("store").idToken}function d(e){if(window.location.href&&!(window.location.href.indexOf(e+"=")<0))return decodeURIComponent(window.location.href.split(e+"=")[1].split("&")[0])}function l(e){if(!e)throw new Error("Missing provider");if(!j("store").tenantId)throw new Error("Missing tenant ID");return`https://api.userfront.com/v0/auth/${e}/login?tenant_id=${j("store").tenantId}&origin=${window.location.origin}&pathname=${window.location.pathname}`}async function _(){try{const{data:e}=await j("axios").get(`${j("apiUrl")}tenants/${j("store").tenantId}/mode`);j("store").mode=e.mode||"test"}catch(e){j("store").mode="test"}}async function h({method:e,username:t,name:r,email:n,password:o}){if(!e)throw new Error('Userfront.signup called without "method" property');switch(e){case"azure":case"facebook":case"github":case"google":case"linkedin":return j("signupWithSSO")(e);case"password":return j("signupWithPassword")({username:t,name:r,email:n,password:o});default:throw new Error('Userfront.signup called with invalid "method" property')}}function f(e){if(!e)throw new Error("Missing provider");const t=j("getProviderLink")(e);window.location.assign(t)}async function w({username:e,name:t,email:r,password:n}){const{data:o}=await j("axios").post(j("apiUrl")+"auth/create",{tenantId:j("store").tenantId,username:e,name:t,email:r,password:n});if(!o.tokens)throw new Error("Please try again.");j("setCookiesAndTokens")(o.tokens),j("redirectToPath")(j("getQueryAttr")("redirect")||o.redirectTo||"/")}async function k({method:e,email:t,username:r,emailOrUsername:n,password:o,token:s,uuid:i}){if(!e)throw new Error('Userfront.login called without "method" property');switch(e){case"azure":case"facebook":case"github":case"google":case"linkedin":return j("loginWithSSO")(e);case"password":return j("loginWithPassword")({email:t,username:r,emailOrUsername:n,password:o});case"link":return j("loginWithLink")(s,i);default:throw new Error('Userfront.login called with invalid "method" property')}}function g(e){if(!e)throw new Error("Missing provider");const t=j("getProviderLink")(e);window.location.assign(t)}async function p({email:e,username:t,emailOrUsername:r,password:n}){const{data:o}=await j("axios").post(j("apiUrl")+"auth/basic",{tenantId:j("store").tenantId,emailOrUsername:e||t||r,password:n});if(!o.tokens)throw new Error("Please try again.");j("setCookiesAndTokens")(o.tokens),j("redirectToPath")(j("getQueryAttr")("redirect")||o.redirectTo||"/")}async function m(e,t){if(e||(e=j("getQueryAttr")("token")),t||(t=j("getQueryAttr")("uuid")),!e||!t)return;const{data:r}=await j("axios").put(j("apiUrl")+"auth/link",{token:e,uuid:t,tenantId:j("store").tenantId});if(!r.tokens)throw new Error("Problem logging in.");j("setCookiesAndTokens")(r.tokens),j("redirectToPath")(j("getQueryAttr")("redirect")||r.redirectTo||"/")}async function T(e){try{const{data:t}=await j("axios").post(j("apiUrl")+"auth/link",{email:e,tenantId:j("store").tenantId});return t}catch(e){throw new Error("Problem sending link")}}async function E(e){try{const{data:t}=await j("axios").post(j("apiUrl")+"auth/reset/link",{email:e,tenantId:j("store").tenantId});return t}catch(e){throw new Error("Problem sending link")}}async function v({uuid:e,token:t,password:r}){if(t||(t=j("getQueryAttr")("token")),e||(e=j("getQueryAttr")("uuid")),!t||!e)throw new Error("Missing token or uuid");const{data:n}=await j("axios").put(j("apiUrl")+"auth/reset",{tenantId:j("store").tenantId,uuid:e,token:t,password:r});if(!n.tokens)throw new Error("There was a problem resetting your password. Please try again.");j("setCookiesAndTokens")(n.tokens),j("redirectToPath")(j("getQueryAttr")("redirect")||n.redirectTo||"/")}async function y(){if(!j("store").accessToken)return j("removeAllCookies")();try{const{data:e}=await j("axios").get(j("apiUrl")+"self",{headers:{authorization:"Bearer "+j("store").accessToken}});e.tenant&&e.tenant.loginRedirectPath&&j("redirectToPath")(e.tenant.loginRedirectPath)}catch(e){j("removeAllCookies")()}}function I(e){if(!e)return;const t=document.createElement("a");t.href=e,t.pathname!==window.location.pathname&&(window.location.href=`${t.pathname}${t.hash}${t.search}`)}async function R(){if(!j("store").accessToken)return j("removeAllCookies")();try{const{data:e}=await j("axios").get(j("apiUrl")+"auth/logout",{headers:{authorization:"Bearer "+j("store").accessToken}});j("removeAllCookies")(),j("redirectToPath")(e.redirectTo)}catch(e){}}function L(e,t,r){const n=`${r}.${j("store").tenantId}`;t=t||{secure:"live"===j("store").mode,sameSite:"Lax"},"refresh"===r&&(t.sameSite="Strict"),j("Cookies").set(n,e,t)}function C(e){j("Cookies").remove(e),j("Cookies").remove(e,{secure:!0,sameSite:"Lax"}),j("Cookies").remove(e,{secure:!0,sameSite:"None"}),j("Cookies").remove(e,{secure:!1,sameSite:"Lax"}),j("Cookies").remove(e,{secure:!1,sameSite:"None"})}function O(){j("removeCookie")(j("store").accessTokenName),j("removeCookie")(j("store").idTokenName),j("removeCookie")(j("store").refreshTokenName),j("store").accessToken=void 0,j("store").idToken=void 0,j("store").refreshToken=void 0}function P(){j("store").accessToken=j("Cookies").get(j("store").accessTokenName),j("store").idToken=j("Cookies").get(j("store").idTokenName),j("store").refreshToken=j("Cookies").get(j("store").refreshTokenName)}function A(e){j("setCookie")(e.access.value,e.access.cookieOptions,"access"),j("setCookie")(e.id.value,e.id.cookieOptions,"id"),j("setCookie")(e.refresh.value,e.refresh.cookieOptions,"refresh"),j("setTokensFromCookies")()}let U=!1;function b(){if(!j("isRegistered")){!function(e,t){let r=W();void 0===r.isRegistered?U=!0:r.isRegistered=!0}();try{history.pushState=(e=history.pushState,function(){var t=e.apply(this,arguments);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("urlchanged")),t}),history.replaceState=(e=>function(){var t=e.apply(this,arguments);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("urlchanged")),t})(history.replaceState),window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("urlchanged"))})}catch(e){}var e}}let N={accessToken:j("accessToken"),getQueryAttr:j("getQueryAttr"),idToken:j("idToken"),init:j("init"),isTestHostname:j("isTestHostname"),login:j("login"),logout:j("logout"),redirectIfLoggedIn:j("redirectIfLoggedIn"),registerUrlChangedEventListener:j("registerUrlChangedEventListener"),resetPassword:j("resetPassword"),sendLoginLink:j("sendLoginLink"),sendResetLink:j("sendResetLink"),setMode:j("setMode"),setCookie:j("setCookie"),signup:j("signup"),store:j("store")};function $(){try{if(global)return global}catch(e){try{if(window)return window}catch(e){return this}}}var S=null;function x(){if(null===S){let e=$();e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__||(e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__=0),S=__$$GLOBAL_REWIRE_NEXT_MODULE_ID__++}return S}function D(){let e=$();return e.__$$GLOBAL_REWIRE_REGISTRY__||(e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)),e.__$$GLOBAL_REWIRE_REGISTRY__}function W(){let e=x(),t=D(),r=t[e];return r||(t[e]=Object.create(null),r=t[e]),r}!function(){let e=$();e.__rewire_reset_all__||(e.__rewire_reset_all__=function(){e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)})}();let G={};function j(N){let $=W();if(void 0===$[N])return function(N){switch(N){case"constants":return r;case"privateIPRegex":return o;case"isTestHostname":return s;case"store":return i;case"setTokensFromCookies":return P;case"Cookies":return t;case"axios":return e;case"apiUrl":return n;case"signupWithSSO":return f;case"signupWithPassword":return w;case"getProviderLink":return l;case"setCookiesAndTokens":return A;case"redirectToPath":return I;case"getQueryAttr":return d;case"loginWithSSO":return g;case"loginWithPassword":return p;case"loginWithLink":return m;case"removeAllCookies":return O;case"removeCookie":return C;case"setCookie":return L;case"isRegistered":return U;case"accessToken":return c;case"idToken":return u;case"init":return a;case"login":return k;case"logout":return R;case"redirectIfLoggedIn":return y;case"registerUrlChangedEventListener":return b;case"resetPassword":return v;case"sendLoginLink":return T;case"sendResetLink":return E;case"setMode":return _;case"signup":return h}}(N);var S=$[N];return"__INTENTIONAL_UNDEFINED__"===S?void 0:S}function M(e,t){let r=W();return"object"==typeof e?(Object.keys(e).forEach(function(t){r[t]=e[t]}),function(){Object.keys(e).forEach(function(t){Q(e)})}):(r[e]=void 0===t?"__INTENTIONAL_UNDEFINED__":t,function(){Q(e)})}function Q(e){let t=W();delete t[e],0==Object.keys(t).length&&delete D()[x]}function B(e){let t=W();var r=Object.keys(e),n={};function o(){r.forEach(function(e){t[e]=n[e]})}return function(s){r.forEach(function(r){n[r]=t[r],t[r]=e[r]});let i=s();return i&&"function"==typeof i.then?i.then(o).catch(o):o(),i}}!function(){function e(e,t){Object.defineProperty(G,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",j),e("__GetDependency__",j),e("__Rewire__",M),e("__set__",M),e("__reset__",Q),e("__ResetDependency__",Q),e("__with__",B)}();let z=typeof N;function F(e,t){Object.defineProperty(N,e,{value:t,enumerable:!1,configurable:!0})}"object"!==z&&"function"!==z||!Object.isExtensible(N)||(F("__get__",j),F("__GetDependency__",j),F("__Rewire__",M),F("__set__",M),F("__reset__",Q),F("__ResetDependency__",Q),F("__with__",B),F("__RewireAPI__",G));export default N;export{j as __GetDependency__,Q as __ResetDependency__,G as __RewireAPI__,M as __Rewire__,j as __get__,M as __set__};
//# sourceMappingURL=userfront-core.modern.js.map
